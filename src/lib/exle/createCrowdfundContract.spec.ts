import { describe, it, expect, vi } from 'vitest';
import {
	createCrowdfundContract,
	EXLE_MAX_BYTE_BOX_FEE,
	EXLE_MINING_FEE,
	EXLE_SLE_CROWD,
	EXLE_SLE_REPAYMENT_TOKEN_ID
} from './exle';
import { SByte, SColl, SLong } from '@fleet-sdk/serializer';
import { ErgoAddress } from '@fleet-sdk/core';
import { ErgoTree } from 'ergo-lib-wasm-nodejs';

describe('createCrowdfundContract', () => {
	it('should return a string address', () => {
		//prettier-ignore
		const expectedAddress = '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';
		//prettier-ignore
		const expetedTree = '104f04000e2005692a2965c6bab42ef7e440ce25108e7f5cad42ec97ea7fe4fc6d55b71191410201050004000580a4e803040004000e2052cdac4eaeeade5c52056b1a5e6ccb5d5c04f81988b15afa27b93dd3b56d4cf9050204020402040404060404040204000e20302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc00504040205020100040204000402040404020400040204000400050204020402040204040500050005000500050005000500050005000502040204020404050404040502040404020404040404000404040205020402040204020402050004020500040205020400050204020502050004000502040205020500d810d601db6501fed602b27201730000d603db63087202d6047301d605860283010273027303d606b2a5730400d607c2a7d608db63087206d609db6308a7d60a92c1a77305d60bb2a4730600d60cb27203730700d60d9683030193c272027207938c720c017308938c720c027309d60eb27209730a017205d60fb27208730b017205d6108c720f029595ed93b17203730c93b17201730dd801d611db6308b27201730e0096830401938cb27211730f0001e4c67202040e938cb2721173100001731193e4c6720206057312938cb272037313000273147315d806d61193e4c67202040e7204d612b2db6308b2a47316007317017205d613e4c67202050ed614db6308b2a5731800d615c6b27201731900070ed6168c721202d1968303017211968303017211938c72120172139593b17214731ad801d617b27214731b01720596830201938c721701e47215938c7217027216d802d617b27214731c017205d6188c72170196830301937218e47215938c7217029972168cb27214731d01720502937218721393c2720672079596830401ed93c5a7c5720b937207c2b2a5731e008f8c720e027210947210731f938c720e018c720f01d805d611b4a473209ab1a47321d612e4c67202050ed613b2a5732200d614db63087213d615e4c6b27201732300070ed19683040193e4c6720206057324968302019399b0dc0c0f721101d9011663b5db63087216d901184d0e938c72180172127325d90116414d0e9a8c7216018c8c72160202b0b57214d901164d0e938c72160172127326d90116414d0e9a8c7216018c8c7216020299b0b57214d901164d0e938c72160172157327d90116414d0e9a8c7216018c8c72160202b0dc0c0f721101d9011663b5db63087216d901184d0e938c72180172157328d90116414d0e9a8c7216018c8c721602029399b0b57208d901164d0e938c72160172127329d90116414d0e9a8c7216018c8c72160202b0b57209d901164d0e938c7216017212732ad90116414d0e9a8c7216018c8c7216020299b0b57209d901164d0e938c7216017215732bd90116414d0e9a8c7216018c8c72160202b0b57208d901164d0e938c7216017215732cd90116414d0e9a8c7216018c8c72160202af7211d901166393c27216c27213720ad802d611c67202040ed612c67202050e9593e4c672020605732dd805d613b2a5732e00d614e47212d615db63087213d616b27215732f00d617b27208733000d19683060193c2721372079683030193e47211e4c67213040e937214e4c67213050e93e4c6721306057331968302019683030193b172157332938c7216017214938c721602733396830201938c721701e4c6720b070e938c7217028cb2720973340002938cb2db6308720b733500017204720d720ad80ad613b27208733600d6148c721302d615b27201733700d616b2e4c672150411733800d6179372147216d618e4c67215070ed619938c7213017218d61a9972148cb27209733901720502d61be47212d61ce47211d19683080196830201957217d801d61db27208733a0096830301938c721d02733b938c721d018cb27209733c00017219d802d61db27209733d00d61eb27208733e009683030193998c721d028c721e02721a938c721e018c721d0172199399b0b5db6308b2a5733f00d9011d4d0e938c721d01721b7340d9011d414d0e9a8c721d018c8c721d0202b0b5db6308b2a4734100d9011d4d0e938c721d01721b7342d9011d414d0e9a8c721d018c8c721d0202721a968302017219938cb2db6308721573430001721c9683020193721ce4c67206040e93721be4c67206050e9572179683040193e4c6720606057344938cb27208734500027346938cb2720873470002734872179683030193e4c6720606057349938cb27208734a0002734b948cb27208734c0002734d93c272067207720d720a90b0b57208d9011d4d0e938c721d017218734ed9011d414d0e9a8c721d018c8c721d02027216';
		//prettier-ignore
		const actualAddress = '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';
		//prettier-ignore
		const actualTree = '105404000e2005692a2965c6bab42ef7e440ce25108e7f5cad42ec97ea7fe4fc6d55b711914104000580a4e803040004000e2052cdac4eaeeade5c52056b1a5e6ccb5d5c04f81988b15afa27b93dd3b56d4cf905020201050004020402040404060404040204000e20302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc00504040205020100040205000500040405000500040405d00f040204000580897a050005000400050204020402040204040500050005000500050005000500050005000502040204020404050404040502040404020404040404000404040205020402040204020402050004020500040205020400050204020502050004000502040205020500d810d601db6501fed602b27201730000d603db63087202d6047301d605c2a7d606b2a5730200d607db63087206d608db6308a7d60992c1a77303d60ab2a4730400d60bb27203730500d60c9683030193c272027205938c720b017306938c720b027307d60d860283010273087309d60eb27208730a01720dd60fb27207730b01720dd6108c720f029595ed93b17203730c93b17201730dd801d611db6308b27201730e0096830401938cb27211730f0001e4c67202040e938cb2721173100001731193e4c6720206057312938cb272037313000273147315d807d611b5a4d901116394c272117205d612e4c67202050ed613db6308b2a5731600d61499b0dc0c0f721101d9011463b5db63087214d901164d0e938c72160172127317d90114414d0e9a8c7214018c8c72140202b0b57213d901144d0e938c72140172127318d90114414d0e9a8c7214018c8c72140202d615b27201731900d616e4c67215070ed61799b0b57213d901174d0e938c7217017216731ad90117414d0e9a8c7217018c8c72170202b0dc0c0f721101d9011763b5db63087217d901194d0e938c7219017216731bd90117414d0e9a8c7217018c8c72170202d19683030193e4c67202040e720496830201939a72149d9c72149cb2e4c672150411731c0099731db2e4c6b27201731e000811731f00732072179399b0dc0c0fb5a4d901186393c27218720501d9011863b5db63087218d9011a4d0e938c721a0172167321d90118414d0e9a8c7218018c8c72180202b0b57207d901184d0e938c72180172167322d90118414d0e9a8c7218018c8c72180202721793c2720672059596830401ed93c5a7c5720a937205c2b2a57323008f8c720e0272109472107324938c720e018c720f01d805d611b4a473259ab1a47326d612e4c67202050ed613b2a5732700d614db63087213d615e4c6b27201732800070ed19683040193e4c6720206057329968302019399b0dc0c0f721101d9011663b5db63087216d901184d0e938c7218017212732ad90116414d0e9a8c7216018c8c72160202b0b57214d901164d0e938c7216017212732bd90116414d0e9a8c7216018c8c7216020299b0b57214d901164d0e938c7216017215732cd90116414d0e9a8c7216018c8c72160202b0dc0c0f721101d9011663b5db63087216d901184d0e938c7218017215732dd90116414d0e9a8c7216018c8c721602029399b0b57207d901164d0e938c7216017212732ed90116414d0e9a8c7216018c8c72160202b0b57208d901164d0e938c7216017212732fd90116414d0e9a8c7216018c8c7216020299b0b57208d901164d0e938c72160172157330d90116414d0e9a8c7216018c8c72160202b0b57207d901164d0e938c72160172157331d90116414d0e9a8c7216018c8c72160202af7211d901166393c27216c272137209d802d611c67202040ed612c67202050e9593e4c6720206057332d805d613b2a5733300d614e47212d615db63087213d616b27215733400d617b27207733500d19683060193c2721372059683030193e47211e4c67213040e937214e4c67213050e93e4c6721306057336968302019683030193b172157337938c7216017214938c721602733896830201938c721701e4c6720a070e938c7217028cb2720873390002938cb2db6308720a733a00017204720c7209d80ad613b27207733b00d6148c721302d615b27201733c00d616b2e4c672150411733d00d6179372147216d618e4c67215070ed619938c7213017218d61a9972148cb27208733e01720d02d61be47212d61ce47211d19683080196830201957217d801d61db27207733f0096830301938c721d027340938c721d018cb27208734100017219d802d61db27208734200d61eb272077343009683030193998c721d028c721e02721a938c721e018c721d0172199399b0b5db6308b2a5734400d9011d4d0e938c721d01721b7345d9011d414d0e9a8c721d018c8c721d0202b0b5db6308b2a4734600d9011d4d0e938c721d01721b7347d9011d414d0e9a8c721d018c8c721d0202721a968302017219938cb2db6308721573480001721c9683020193721ce4c67206040e93721be4c67206050e9572179683040193e4c6720606057349938cb27207734a0002734b938cb27207734c0002734d72179683030193e4c672060605734e938cb27207734f00027350948cb2720773510002735293c272067205720c720990b0b57207d9011d4d0e938c721d0172187353d9011d414d0e9a8c721d018c8c721d02027216';

		const params = {
			_MinFee: SLong(EXLE_MINING_FEE).toHex(),
			_MaxByteBoxFee: SLong(EXLE_MAX_BYTE_BOX_FEE).toHex(),
			_LoanId: SColl(
				SByte,
				'05692a2965c6bab42ef7e440ce25108e7f5cad42ec97ea7fe4fc6d55b7119141'
			).toHex(),
			_SLTCFTokenId: SColl(SByte, EXLE_SLE_CROWD).toHex(),
			_SLTRepaymentTokenId: SColl(SByte, EXLE_SLE_REPAYMENT_TOKEN_ID).toHex()
		};
		ErgoTree;
		const result = createCrowdfundContract(params);
		const treeCompiled = ErgoAddress.fromBase58(result).ergoTree;
		const treeExpected = ErgoAddress.fromBase58(expectedAddress).ergoTree;
		//console.log(tree);
		const template1 = ErgoTree.from_base16_bytes(treeCompiled).template_bytes();
		const template2 = ErgoTree.from_base16_bytes(treeExpected).template_bytes();
		expect(template1).toBe(template2);
		//expect(expectedAddress).toBe(result);
	});
});

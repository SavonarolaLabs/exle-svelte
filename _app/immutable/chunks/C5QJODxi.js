var Fo=Object.defineProperty;var Dn=e=>{throw TypeError(e)};var Mo=(e,t,n)=>t in e?Fo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var A=(e,t,n)=>Mo(e,typeof t!="symbol"?t+"":t,n),Jt=(e,t,n)=>t.has(e)||Dn("Cannot "+n);var d=(e,t,n)=>(Jt(e,t,"read from private field"),n?n.call(e):t.get(e)),T=(e,t,n)=>t.has(e)?Dn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),p=(e,t,n,s)=>(Jt(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),se=(e,t,n)=>(Jt(e,t,"access private method"),n);var Ue=(e,t,n,s)=>({set _(o){p(e,t,o,n)},get _(){return d(e,t,s)}});import{aN as $o,ae as Un,h as _n,aO as jo,aP as zo,q as Xo}from"./DDT3yhNO.js";import{b as Vo,i as Go,c as Fn,d as Ko,f as Qo,n as Wo,g as Yo}from"./CnOWsFPg.js";import{d as ws,w as Oe,g as qo}from"./CofUJuP7.js";function J0(e){if(_n){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;an(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var o=e.checked;an(e,"checked",null),e.checked=o}}};e.__on_r=n,zo(n),Vo()}}function an(e,t,n,s){var o=e.__attributes??(e.__attributes={});_n&&(o[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||o[t]!==(o[t]=n)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[$o]=n),n==null?e.removeAttribute(t):typeof n!="string"&&Is(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function ea(e,t,n,s,o=!1,r=!1,i=!1){var a=t||{},c=e.tagName==="OPTION";for(var f in t)f in n||(n[f]=null);var g=Is(e),u=e.__attributes??(e.__attributes={}),m=[];for(const w in n){let E=n[w];if(c&&w==="value"&&E==null){e.value=e.__value="",a[w]=E;continue}var l=a[w];if(E!==l){a[w]=E;var x=w[0]+w[1];if(x!=="$$"){if(x==="on"){const v={},R="$$"+w;let I=w.slice(2);var y=Yo(I);if(Go(I)&&(I=I.slice(0,-7),v.capture=!0),!y&&l){if(E!=null)continue;e.removeEventListener(I,a[R],v),a[R]=null}if(E!=null)if(y)e[`__${I}`]=E,Ko([I]);else{let te=function(ne){a[w].call(this,ne)};t?a[R]=Fn(I,e,te,v):m.push([w,E,()=>a[R]=Fn(I,e,te,v)])}}else if(w==="style"&&E!=null)e.style.cssText=E+"";else if(w==="autofocus")Qo(e,!!E);else if(w==="__value"||w==="value"&&E!=null)e.value=e[w]=e.__value=E;else{var k=w;o||(k=Wo(k)),E==null&&!r?(u[w]=null,e.removeAttribute(w)):g.includes(k)&&(r||typeof E!="string")?e[k]=E:typeof E!="function"&&(_n&&(k==="src"||k==="href"||k==="srcset")||an(e,k,E))}w==="style"&&"__styles"in e&&(e.__styles={})}}}return t||Xo(()=>{if(e.isConnected)for(const[w,E,v]of m)a[w]===E&&v()}),a}var Mn=new Map;function Is(e){var t=Mn.get(e.nodeName);if(t)return t;Mn.set(e.nodeName,t=[]);for(var n,s=Un(e),o=Element.prototype;o!==s;){n=jo(s);for(var r in n)n[r].set&&t.push(r);s=Un(s)}return t}function de(e,t){if(e)return;let n;switch(typeof t){case"string":n=new Error(t);break;case"function":n=new Error(t());break;default:n=t}throw n}function Ts(e,t){const n=typeof e;if(n!==t)throw new Error(`Expected an object of type '${t}', got '${n}'.`)}function Zo(e){if(e===null)return"null";const t=typeof e;return t==="object"||t==="function"?Object.prototype.toString.call(e).slice(8,-1):t}function vn(e,t){if(!(e instanceof t))throw new Error(`Expected an instance of '${t.name}', got '${Zo(e)}'.`)}function W(e){return e?Array.isArray(e)?e.length===0:Object.keys(e).length===0:!0}function D(e){return!W(e)}function C(e){return e==null||Number.isNaN(e)}function B(e){return!C(e)}function Ye(e){if(e)return de(e.length>0,"Empty array."),e[0]}function Jo(e){if(e)return de(e.length>0,"Empty array."),er(e,-1)}function er(e,t){const n=e==null?void 0:e.length;if(n)return t<0&&(t+=n),e[t]}function tr(e,t){return e.some((n,s)=>e.findIndex(o=>t(o)===t(n))!==s)}function nr(e,t){if(W(e))return[];if(e.length<=t)return[e];const n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}function sr(e,t,n="asc"){return[...e].sort((s,o)=>t(s)>t(o)?n==="asc"?1:-1:t(s)<t(o)?n==="asc"?-1:1:0)}function or(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function $n(e,t){if(e===t)return!0;if(t.length>e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function rr(e,t){if(e===t)return!0;if(t.length>e.length)return!1;const n=e.length-t.length;for(let s=t.length-1;s>=0;s--)if(t[s]!==e[s+n])return!1;return!0}var _=BigInt(0),Ke=BigInt(1),xs=BigInt(7);BigInt(10);var ir=BigInt(63),ks=BigInt(127),Es=BigInt(128);function H(e){return typeof e=="bigint"?e:BigInt(e)}function cn(e,t,n){let s=_;if(W(e))return s;for(const o of e)(C(n)||n(o))&&(s+=t(o));return s}var Je="nanoErgs";function me(e,t){const n={};for(const s of e)if((C(t)||t===Je)&&(n[Je]=(n[Je]||_)+H(s.value)),t!==Je)for(const o of s.assets)B(t)&&t!==o.tokenId||(n[o.tokenId]=(n[o.tokenId]||_)+H(o.amount));return B(t)?n[t]||_:{nanoErgs:n[Je]||_,tokens:Object.keys(n).filter(s=>s!==Je).map(s=>({tokenId:s,amount:n[s]}))}}function Dt(e,t,n=!1){Array.isArray(e)&&(e=me(e)),Array.isArray(t)&&(t=me(t));const s=[],o=e.nanoErgs-t.nanoErgs,r=new Map(t.tokens.map(i=>[i.tokenId,i.amount]));for(const i of e.tokens){const a=r.get(i.tokenId)||_,c=i.amount-(a||_);c!==_&&s.push({tokenId:i.tokenId,amount:c}),a>_&&r.delete(i.tokenId)}if(!n&&r.size>0)for(const[i,a]of r)s.push({tokenId:i,amount:-a});return{nanoErgs:o,tokens:s}}var jn=4,ar=9;function cr(e){let t=0;for(let n=jn;n<=ar;n++){const s=`R${n}`;if(e[s]){if(n===jn){t=n;continue}if(n-t>1)return!1;t=n}}return!0}function dn(...e){const t=new Uint8Array(e.reduce((s,o)=>s+o.length,0));let n=0;for(const s of e)vn(s,Uint8Array),t.set(s,n),n+=s.length;return t}function _s(e){return!e||e.length%2?!1:!Number.isNaN(Number(e.startsWith("0x")?e:`0x${e}`))}function It(e){return e.length/2}var Kt=(e=>(e[e.Mainnet=0]="Mainnet",e[e.Testnet=16]="Testnet",e))(Kt||{}),V=(e=>(e[e.P2PK=1]="P2PK",e[e.P2SH=2]="P2SH",e[e.P2S=3]="P2S",e[e.ADH=4]="ADH",e))(V||{}),zn={sizeInclusion:8,constantSegregation:16},Rn=class{constructor(){A(this,"_items");this._items=[]}_isIndexOutOfBounds(e){return e<0||e>=this._items.length}[Symbol.iterator](){let e=0;return{next:()=>({done:e>=this.length,value:this._items[e++]})}}get length(){return this._items.length}get isEmpty(){return this.length===0}at(e){if(this._isIndexOutOfBounds(e))throw new RangeError(`Index '${e}' is out of range.`);return this._items[e]}add(e,t){return this._addOneOrMore(e,t)}_addOne(e,t){if(B(t)&&B(t.index)){if(t.index===this.length)return this._items.push(this._map(e)),this.length;if(this._isIndexOutOfBounds(t.index))throw new RangeError(`Index '${t.index}' is out of range.`);return this._items.splice(t.index,0,this._map(e)),this.length}return this._items.push(this._map(e)),this._items.length}_addOneOrMore(e,t){if(Array.isArray(e)){B(t)&&B(t.index)&&(e=e.reverse());for(const n of e)this._addOne(n,t)}else this._addOne(e,t);return this.length}toArray(){return[...this._items]}reduce(e,t){return this._items.reduce(e,t)}},Tt=class extends Error{constructor(e,t){super(e,t),Object.setPrototypeOf(this,new.target.prototype),this.name=new.target.name}};function en(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function dr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function vs(e,...t){if(!dr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function jt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Rs(e,t){vs(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function zt(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function tn(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function oe(e,t){return e<<32-t|e>>>t}const Me=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Bs(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const fe=Me?e=>e:e=>Bs(e);function et(e){for(let t=0;t<e.length;t++)e[t]=Bs(e[t])}function ur(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function Qe(e){return typeof e=="string"&&(e=ur(e)),vs(e),e}class As{clone(){return this._cloneInto()}}function fr(e){const t=s=>e().update(Qe(s)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function lr(e){const t=(s,o)=>e(o).update(Qe(s)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=s=>e(s),t}const hr=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]);class gr extends As{constructor(t,n,s={},o,r,i){if(super(),this.blockLen=t,this.outputLen=n,this.length=0,this.pos=0,this.finished=!1,this.destroyed=!1,en(t),en(n),en(o),n<0||n>o)throw new Error("outputLen bigger than keyLen");if(s.key!==void 0&&(s.key.length<1||s.key.length>o))throw new Error("key length must be undefined or 1.."+o);if(s.salt!==void 0&&s.salt.length!==r)throw new Error("salt must be undefined or "+r);if(s.personalization!==void 0&&s.personalization.length!==i)throw new Error("personalization must be undefined or "+i);this.buffer=new Uint8Array(t),this.buffer32=zt(this.buffer)}update(t){jt(this);const{blockLen:n,buffer:s,buffer32:o}=this;t=Qe(t);const r=t.length,i=t.byteOffset,a=t.buffer;for(let c=0;c<r;){this.pos===n&&(Me||et(o),this.compress(o,0,!1),Me||et(o),this.pos=0);const f=Math.min(n-this.pos,r-c),g=i+c;if(f===n&&!(g%4)&&c+f<r){const u=new Uint32Array(a,g,Math.floor((r-c)/4));Me||et(u);for(let m=0;c+n<r;m+=o.length,c+=n)this.length+=n,this.compress(u,m,!1);Me||et(u);continue}s.set(t.subarray(c,c+f),this.pos),this.pos+=f,this.length+=f,c+=f}return this}digestInto(t){jt(this),Rs(t,this);const{pos:n,buffer32:s}=this;this.finished=!0,this.buffer.subarray(n).fill(0),Me||et(s),this.compress(s,0,!0),Me||et(s);const o=zt(t);this.get().forEach((r,i)=>o[i]=fe(r))}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){const{buffer:n,length:s,finished:o,destroyed:r,outputLen:i,pos:a}=this;return t||(t=new this.constructor({dkLen:i})),t.set(...this.get()),t.length=s,t.finished=o,t.destroyed=r,t.outputLen=i,t.buffer.set(n),t.pos=a,t}}const Ht=BigInt(2**32-1),un=BigInt(32);function Ls(e,t=!1){return t?{h:Number(e&Ht),l:Number(e>>un&Ht)}:{h:Number(e>>un&Ht)|0,l:Number(e&Ht)|0}}function br(e,t=!1){let n=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let o=0;o<e.length;o++){const{h:r,l:i}=Ls(e[o],t);[n[o],s[o]]=[r,i]}return[n,s]}const mr=(e,t)=>BigInt(e>>>0)<<un|BigInt(t>>>0),pr=(e,t,n)=>e>>>n,yr=(e,t,n)=>e<<32-n|t>>>n,wr=(e,t,n)=>e>>>n|t<<32-n,Ir=(e,t,n)=>e<<32-n|t>>>n,Tr=(e,t,n)=>e<<64-n|t>>>n-32,xr=(e,t,n)=>e>>>n-32|t<<64-n,kr=(e,t)=>t,Er=(e,t)=>e,_r=(e,t,n)=>e<<n|t>>>32-n,vr=(e,t,n)=>t<<n|e>>>32-n,Rr=(e,t,n)=>t<<n-32|e>>>64-n,Br=(e,t,n)=>e<<n-32|t>>>64-n;function Ar(e,t,n,s){const o=(t>>>0)+(s>>>0);return{h:e+n+(o/2**32|0)|0,l:o|0}}const Lr=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),Sr=(e,t,n,s)=>t+n+s+(e/2**32|0)|0,Cr=(e,t,n,s)=>(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),Pr=(e,t,n,s,o)=>t+n+s+o+(e/2**32|0)|0,Or=(e,t,n,s,o)=>(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0)+(o>>>0),Hr=(e,t,n,s,o,r)=>t+n+s+o+r+(e/2**32|0)|0,U={fromBig:Ls,split:br,toBig:mr,shrSH:pr,shrSL:yr,rotrSH:wr,rotrSL:Ir,rotrBH:Tr,rotrBL:xr,rotr32H:kr,rotr32L:Er,rotlSH:_r,rotlSL:vr,rotlBH:Rr,rotlBL:Br,add:Ar,add3L:Lr,add3H:Sr,add4L:Cr,add4H:Pr,add5H:Hr,add5L:Or},S=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),b=new Uint32Array(32);function Ie(e,t,n,s,o,r){const i=o[r],a=o[r+1];let c=b[2*e],f=b[2*e+1],g=b[2*t],u=b[2*t+1],m=b[2*n],l=b[2*n+1],x=b[2*s],y=b[2*s+1],k=U.add3L(c,g,i);f=U.add3H(k,f,u,a),c=k|0,{Dh:y,Dl:x}={Dh:y^f,Dl:x^c},{Dh:y,Dl:x}={Dh:U.rotr32H(y,x),Dl:U.rotr32L(y,x)},{h:l,l:m}=U.add(l,m,y,x),{Bh:u,Bl:g}={Bh:u^l,Bl:g^m},{Bh:u,Bl:g}={Bh:U.rotrSH(u,g,24),Bl:U.rotrSL(u,g,24)},b[2*e]=c,b[2*e+1]=f,b[2*t]=g,b[2*t+1]=u,b[2*n]=m,b[2*n+1]=l,b[2*s]=x,b[2*s+1]=y}function Te(e,t,n,s,o,r){const i=o[r],a=o[r+1];let c=b[2*e],f=b[2*e+1],g=b[2*t],u=b[2*t+1],m=b[2*n],l=b[2*n+1],x=b[2*s],y=b[2*s+1],k=U.add3L(c,g,i);f=U.add3H(k,f,u,a),c=k|0,{Dh:y,Dl:x}={Dh:y^f,Dl:x^c},{Dh:y,Dl:x}={Dh:U.rotrSH(y,x,16),Dl:U.rotrSL(y,x,16)},{h:l,l:m}=U.add(l,m,y,x),{Bh:u,Bl:g}={Bh:u^l,Bl:g^m},{Bh:u,Bl:g}={Bh:U.rotrBH(u,g,63),Bl:U.rotrBL(u,g,63)},b[2*e]=c,b[2*e+1]=f,b[2*t]=g,b[2*t+1]=u,b[2*n]=m,b[2*n+1]=l,b[2*s]=x,b[2*s+1]=y}class Nr extends gr{constructor(t={}){super(128,t.dkLen===void 0?64:t.dkLen,t,64,16,16),this.v0l=S[0]|0,this.v0h=S[1]|0,this.v1l=S[2]|0,this.v1h=S[3]|0,this.v2l=S[4]|0,this.v2h=S[5]|0,this.v3l=S[6]|0,this.v3h=S[7]|0,this.v4l=S[8]|0,this.v4h=S[9]|0,this.v5l=S[10]|0,this.v5h=S[11]|0,this.v6l=S[12]|0,this.v6h=S[13]|0,this.v7l=S[14]|0,this.v7h=S[15]|0;const n=t.key?t.key.length:0;if(this.v0l^=this.outputLen|n<<8|65536|1<<24,t.salt){const s=zt(Qe(t.salt));this.v4l^=fe(s[0]),this.v4h^=fe(s[1]),this.v5l^=fe(s[2]),this.v5h^=fe(s[3])}if(t.personalization){const s=zt(Qe(t.personalization));this.v6l^=fe(s[0]),this.v6h^=fe(s[1]),this.v7l^=fe(s[2]),this.v7h^=fe(s[3])}if(t.key){const s=new Uint8Array(this.blockLen);s.set(Qe(t.key)),this.update(s)}}get(){let{v0l:t,v0h:n,v1l:s,v1h:o,v2l:r,v2h:i,v3l:a,v3h:c,v4l:f,v4h:g,v5l:u,v5h:m,v6l:l,v6h:x,v7l:y,v7h:k}=this;return[t,n,s,o,r,i,a,c,f,g,u,m,l,x,y,k]}set(t,n,s,o,r,i,a,c,f,g,u,m,l,x,y,k){this.v0l=t|0,this.v0h=n|0,this.v1l=s|0,this.v1h=o|0,this.v2l=r|0,this.v2h=i|0,this.v3l=a|0,this.v3h=c|0,this.v4l=f|0,this.v4h=g|0,this.v5l=u|0,this.v5h=m|0,this.v6l=l|0,this.v6h=x|0,this.v7l=y|0,this.v7h=k|0}compress(t,n,s){this.get().forEach((c,f)=>b[f]=c),b.set(S,16);let{h:o,l:r}=U.fromBig(BigInt(this.length));b[24]=S[8]^r,b[25]=S[9]^o,s&&(b[28]=~b[28],b[29]=~b[29]);let i=0;const a=hr;for(let c=0;c<12;c++)Ie(0,4,8,12,t,n+2*a[i++]),Te(0,4,8,12,t,n+2*a[i++]),Ie(1,5,9,13,t,n+2*a[i++]),Te(1,5,9,13,t,n+2*a[i++]),Ie(2,6,10,14,t,n+2*a[i++]),Te(2,6,10,14,t,n+2*a[i++]),Ie(3,7,11,15,t,n+2*a[i++]),Te(3,7,11,15,t,n+2*a[i++]),Ie(0,5,10,15,t,n+2*a[i++]),Te(0,5,10,15,t,n+2*a[i++]),Ie(1,6,11,12,t,n+2*a[i++]),Te(1,6,11,12,t,n+2*a[i++]),Ie(2,7,8,13,t,n+2*a[i++]),Te(2,7,8,13,t,n+2*a[i++]),Ie(3,4,9,14,t,n+2*a[i++]),Te(3,4,9,14,t,n+2*a[i++]);this.v0l^=b[0]^b[16],this.v0h^=b[1]^b[17],this.v1l^=b[2]^b[18],this.v1h^=b[3]^b[19],this.v2l^=b[4]^b[20],this.v2h^=b[5]^b[21],this.v3l^=b[6]^b[22],this.v3h^=b[7]^b[23],this.v4l^=b[8]^b[24],this.v4h^=b[9]^b[25],this.v5l^=b[10]^b[26],this.v5h^=b[11]^b[27],this.v6l^=b[12]^b[28],this.v6h^=b[13]^b[29],this.v7l^=b[14]^b[30],this.v7h^=b[15]^b[31],b.fill(0)}destroy(){this.destroyed=!0,this.buffer32.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Dr=lr(e=>new Nr(e));function Ur(e,t,n,s){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,s);const o=BigInt(32),r=BigInt(4294967295),i=Number(n>>o&r),a=Number(n&r),c=s?4:0,f=s?0:4;e.setUint32(t+c,i,s),e.setUint32(t+f,a,s)}function Fr(e,t,n){return e&t^~e&n}function Mr(e,t,n){return e&t^e&n^t&n}class $r extends As{constructor(t,n,s,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=tn(this.buffer)}update(t){jt(this);const{view:n,buffer:s,blockLen:o}=this;t=Qe(t);const r=t.length;for(let i=0;i<r;){const a=Math.min(o-this.pos,r-i);if(a===o){const c=tn(t);for(;o<=r-i;i+=o)this.process(c,i);continue}s.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){jt(this),Rs(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:r}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(s,0),i=0);for(let u=i;u<o;u++)n[u]=0;Ur(s,o-8,BigInt(this.length*8),r),this.process(s,0);const a=tn(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=c/4,g=this.get();if(f>g.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<f;u++)a.setUint32(4*u,g[u],r)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:o,finished:r,destroyed:i,pos:a}=this;return t.length=o,t.pos=a,t.finished=r,t.destroyed=i,o%n&&t.buffer.set(s),t}}const jr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ke=new Uint32Array(64);class zr extends $r{constructor(){super(64,32,8,!1),this.A=xe[0]|0,this.B=xe[1]|0,this.C=xe[2]|0,this.D=xe[3]|0,this.E=xe[4]|0,this.F=xe[5]|0,this.G=xe[6]|0,this.H=xe[7]|0}get(){const{A:t,B:n,C:s,D:o,E:r,F:i,G:a,H:c}=this;return[t,n,s,o,r,i,a,c]}set(t,n,s,o,r,i,a,c){this.A=t|0,this.B=n|0,this.C=s|0,this.D=o|0,this.E=r|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,n){for(let u=0;u<16;u++,n+=4)ke[u]=t.getUint32(n,!1);for(let u=16;u<64;u++){const m=ke[u-15],l=ke[u-2],x=oe(m,7)^oe(m,18)^m>>>3,y=oe(l,17)^oe(l,19)^l>>>10;ke[u]=y+ke[u-7]+x+ke[u-16]|0}let{A:s,B:o,C:r,D:i,E:a,F:c,G:f,H:g}=this;for(let u=0;u<64;u++){const m=oe(a,6)^oe(a,11)^oe(a,25),l=g+m+Fr(a,c,f)+jr[u]+ke[u]|0,y=(oe(s,2)^oe(s,13)^oe(s,22))+Mr(s,o,r)|0;g=f,f=c,c=a,a=i+l|0,i=r,r=o,o=s,s=l+y|0}s=s+this.A|0,o=o+this.B|0,r=r+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,f=f+this.G|0,g=g+this.H|0,this.set(s,o,r,i,a,c,f,g)}roundClean(){ke.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Xr=fr(()=>new zr);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ss(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function Vr(e){if(typeof e!="function")throw new Error("function expected");return!0}function ln(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function Bn(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function hn(e){if(!Array.isArray(e))throw new Error("array expected")}function Cs(e,t){if(!Ss(!0,t))throw new Error(`${e}: array of strings expected`)}function Gr(e,t){if(!Ss(!1,t))throw new Error(`${e}: array of numbers expected`)}function Ps(...e){const t=r=>r,n=(r,i)=>a=>r(i(a)),s=e.map(r=>r.encode).reduceRight(n,t),o=e.map(r=>r.decode).reduce(n,t);return{encode:s,decode:o}}function Kr(e){const t=typeof e=="string"?e.split(""):e,n=t.length;Cs("alphabet",t);const s=new Map(t.map((o,r)=>[o,r]));return{encode:o=>(hn(o),o.map(r=>{if(!Number.isSafeInteger(r)||r<0||r>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${r}". Allowed: ${e}`);return t[r]})),decode:o=>(hn(o),o.map(r=>{ln("alphabet.decode",r);const i=s.get(r);if(i===void 0)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return i}))}}function Qr(e=""){return ln("join",e),{encode:t=>(Cs("join.decode",t),t.join(e)),decode:t=>(ln("join.decode",t),t.split(e))}}function Xn(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(hn(e),!e.length)return[];let s=0;const o=[],r=Array.from(e,a=>{if(Bn(a),a<0||a>=t)throw new Error(`invalid integer: ${a}`);return a}),i=r.length;for(;;){let a=0,c=!0;for(let f=s;f<i;f++){const g=r[f],u=t*a,m=u+g;if(!Number.isSafeInteger(m)||u/t!==a||m-g!==u)throw new Error("convertRadix: carry overflow");const l=m/n;a=m%n;const x=Math.floor(l);if(r[f]=x,!Number.isSafeInteger(x)||x*n+a!==m)throw new Error("convertRadix: carry overflow");if(c)x?c=!1:s=f;else continue}if(o.push(a),c)break}for(let a=0;a<e.length-1&&e[a]===0;a++)o.push(0);return o.reverse()}function Wr(e){Bn(e);const t=2**8;return{encode:n=>{if(!fn(n))throw new Error("radix.encode input should be Uint8Array");return Xn(Array.from(n),t,e)},decode:n=>(Gr("radix.decode",n),Uint8Array.from(Xn(n,e,t)))}}function Yr(e,t){return Bn(e),Vr(t),{encode(n){if(!fn(n))throw new Error("checksum.encode: input should be Uint8Array");const s=t(n).slice(0,e),o=new Uint8Array(n.length+e);return o.set(n),o.set(s,n.length),o},decode(n){if(!fn(n))throw new Error("checksum.decode: input should be Uint8Array");const s=n.slice(0,-e),o=n.slice(-e),r=t(s).slice(0,e);for(let i=0;i<e;i++)if(r[i]!==o[i])throw new Error("Invalid checksum");return s}}}const qr=e=>Ps(Wr(58),Kr(e),Qr("")),Os=qr("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Zr=e=>Ps(Yr(4,t=>e(e(t))),Os),Jr=Zr;var ei=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),ue={ZERO:48,NINE:57,A_UP:65,F_UP:70,A_LO:97,F_LO:102};function ti(e){vn(e,Uint8Array);let t="";for(let n=0,s=e.length;n<s;n++)t+=ei[e[n]];return t}function ni(e){Ts(e,"string"),de(e.length%2===0,"Invalid hex padding.");const t=e.length/2,n=new Uint8Array(t);for(let s=0,o=0;s<t;s++){const r=Vn(e.charCodeAt(o++)),i=Vn(e.charCodeAt(o++));n[s]=r*16+i}return n}function Vn(e){if(e>=ue.ZERO&&e<=ue.NINE)return e-ue.ZERO;if(e>=ue.A_UP&&e<=ue.F_UP)return e-(ue.A_UP-10);if(e>=ue.A_LO&&e<=ue.F_LO)return e-(ue.A_LO-10);throw new Error("Invalid byte sequence.")}var M={encode:ti,decode:ni};function si(e){return vn(e,Uint8Array),new TextDecoder().decode(e)}function oi(e){return Ts(e,"string"),new Uint8Array(new TextEncoder().encode(e))}var nn={encode:si,decode:oi};Jr(ii);var tt=Os;function ce(e){return typeof e=="string"?M.decode(e):e}function ri(e,t){return t!=null&&t.key&&(t.key=ce(t.key)),t!=null&&t.salt&&(t.salt=ce(t.salt)),t!=null&&t.personalization&&(t.personalization=ce(t.personalization)),Dr(ce(e),t)}function bt(e,t){return ri(ce(e),{dkLen:32,...t})}function ii(e){return Xr(ce(e))}function Hs(e){if(W(e))return!1;switch(e[0]){case 2:case 3:return e.length===33;case 4:return e.length===65;default:return!1}}function ai(e){const t=BigInt(e.length%2?`0x0${e}`:`0x${e}`);return 128&Number.parseInt(e.slice(0,2),16)?-Ns(t):t}function ci(e){const t=e>=_;let n=(t?e:Ns(e)).toString(16);return n.length%2&&(n=`0${n}`),t&&128&Number.parseInt(n.slice(0,2),16)?`00${n}`:n}function Ns(e){let t=e;const n=t<_;n&&(t=-t);const s=t.toString(2);let o=s.length;const r=o%8;r>0?o+=8-r:n&&Ye(s)==="1"&&s.indexOf("1",1)!==-1&&(o+=8);const i=(1n<<BigInt(o))-1n;return(~t&i)+1n}function di(e,t){if(t===0)return e.write(0);if(t<0)throw new RangeError("Variable Length Quantity not supported for negative numbers.");let n=t;do{let s=n&127;n>>=7,n>0&&(s|=128),e.write(s)}while(n>0);return e}function Gn(e){if(e.isEmpty)return 0;let t=0,n=0,s=0;do s=e.readByte(),t|=(s&127)<<n,n+=7;while(s&128);return t}function ui(e,t){if(t===_)return e.write(0);if(t<_)throw new RangeError("Variable Length Quantity not supported for negative numbers");let n=t;do{let s=Number(n&ks);n>>=xs,n>0&&(s|=128),e.write(s)}while(n>0);return e}function sn(e){if(e.isEmpty)return _;let t=_,n=_,s=_;do s=BigInt(e.readByte()),t|=(s&ks)<<n,n+=xs;while((s&Es)!==_);return t}function N(e){let t=0,n=e;if(typeof n=="number"){do t++,n=Math.floor(n/128);while(n>0);return t}n=H(n);do t++,n/=Es;while(n>_);return t}var fi=BigInt(31),Ds=e=>BigInt.asUintN(64,e),li=e=>BigInt.asIntN(64,e),on=e=>BigInt.asIntN(32,e),hi=e=>BigInt.asUintN(32,e),Xt={encode:e=>{const t=on(BigInt(e));return Ds(on(t<<Ke)^on(t>>fi))},decode:e=>{const t=hi(e);return Number(t>>Ke^-(t&Ke))}},Us={encode:e=>Ds(e<<Ke^e>>ir),decode:e=>li(e>>Ke^-(e&Ke))},gi=255,bi=127,mi=-32768,pi=32767,yi=-2147483648,wi=2147483647,Ii=-BigInt("0x8000000000000000"),Ti=BigInt("0x7fffffffffffffff"),xi=-BigInt("0x8000000000000000000000000000000000000000000000000000000000000000"),ki=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Ee,ie,ds,Ei=(ds=class{constructor(e){T(this,Ee);T(this,ie);p(this,Ee,ce(e)),p(this,ie,0)}get isEmpty(){return W(d(this,Ee))}readBool(){return this.readByte()===1}readBits(e){const t=new Array(e);let n=0;for(let s=0;s<e;s++){const o=d(this,Ee)[d(this,ie)]>>n++&1;t[s]=o===1,n===8&&(n=0,Ue(this,ie)._++)}return n>0&&Ue(this,ie)._++,t}readByte(){return d(this,Ee)[Ue(this,ie)._++]}readBytes(e){return d(this,Ee).subarray(d(this,ie),p(this,ie,d(this,ie)+e))}readVlq(){return Gn(this)}readI8(){const e=this.readByte();return e>bi?e-(gi+1):e}readI16(){return Xt.decode(sn(this))}readI32(){return Xt.decode(sn(this))}readI64(){return Us.decode(sn(this))}readI256(){const e=Gn(this);return ai(M.encode(this.readBytes(e)))}},Ee=new WeakMap,ie=new WeakMap,ds),Y,j,us,Qt=(us=class{constructor(e){T(this,Y);T(this,j);p(this,Y,new Uint8Array(e)),p(this,j,0)}get length(){return d(this,j)}writeBool(e){return this.write(e===!0?1:0),this}writeVLQ(e){return di(this,e)}writeBigVLQ(e){return ui(this,e)}writeI16(e){if(e<mi||e>pi)throw new RangeError(`Value ${e} is out of range for a 16-bit integer`);return this.writeBigVLQ(Xt.encode(e)),this}writeI32(e){if(e<yi||e>wi)throw new RangeError(`Value ${e} is out of range for a 32-bit integer`);return this.writeBigVLQ(Xt.encode(e))}writeI64(e){if(e<Ii||e>Ti)throw new RangeError(`Value ${e} is out of range for a 64-bit integer`);return this.writeBigVLQ(Us.encode(e))}writeI256(e){if(e<xi||e>ki)throw new RangeError(`Value ${e} is out of range for a 256-bit integer`);const t=ci(e);return this.writeVLQ(t.length/2).writeHex(t)}write(e){return d(this,Y)[Ue(this,j)._++]=e,this}writeBytes(e){return d(this,Y).set(e,d(this,j)),p(this,j,d(this,j)+e.length),this}writeHex(e){return this.writeBytes(M.decode(e))}writeBits(e){let t=0;for(let n=0;n<e.length;n++)e[n]?d(this,Y)[d(this,j)]|=1<<t++:d(this,Y)[d(this,j)]&=~(1<<t++),t===8&&(t=0,Ue(this,j)._++);return t>0&&Ue(this,j)._++,this}writeChecksum(e=4,t=bt){const n=t(this.toBytes());return this.writeBytes(e?n.subarray(0,e):n)}encode(e){return e.encode(this.toBytes())}toBytes(){return d(this,j)===d(this,Y).length?d(this,Y):d(this,Y).subarray(0,d(this,j))}},Y=new WeakMap,j=new WeakMap,us),Fs=class{coerce(e){return e}},Ms=class extends Fs{get embeddable(){return!1}},He=class extends Ms{get embeddable(){return!0}},vt,fs,$s=(fs=class extends Fs{constructor(t){super();T(this,vt);p(this,vt,t)}get elementsType(){return d(this,vt)}get embeddable(){return!1}},vt=new WeakMap,fs),js=class extends He{get code(){return 1}toString(){return"SBool"}},zs=class extends He{get code(){return 2}toString(){return"SByte"}},Xs=class extends He{get code(){return 3}toString(){return"SShort"}},Vs=class extends He{get code(){return 4}toString(){return"SInt"}},Gs=class extends He{get code(){return 5}coerce(e){return H(e)}toString(){return"SLong"}},Ks=class extends He{get code(){return 6}coerce(e){return H(e)}toString(){return"SBigInt"}},Qs=class extends He{get code(){return 7}coerce(e){return typeof e=="string"?M.decode(e):e}toString(){return"SGroupElement"}},Ws=class extends He{get code(){return 8}toString(){return"SSigmaProp"}},Ys=class extends Ms{get code(){return 98}toString(){return"SUnit"}},O=Object.freeze({embeddable:0,simpleColl:1,nestedColl:2,option:3,optionCollection:4,pairOne:5,pairTwo:6,symmetricPair:7,genericTuple:8}),qs=11,gn=qs+1,re=e=>gn*e,_i=Object.freeze({code:re(O.simpleColl),embeddable:!1,simpleCollTypeCode:re(O.simpleColl),nestedCollTypeCode:re(O.nestedColl)}),vi=Object.freeze({code:re(O.pairOne),embeddable:!1,pairOneTypeCode:re(O.pairOne),pairTwoTypeCode:re(O.pairTwo),tripleTypeCode:re(O.pairTwo),symmetricPairTypeCode:re(O.symmetricPair),quadrupleTypeCode:re(O.symmetricPair),genericTupleTypeCode:re(O.genericTuple)}),h={bool:new js,byte:new zs,short:new Xs,int:new Vs,long:new Gs,bigInt:new Ks,groupElement:new Qs,sigmaProp:new Ws,unit:new Ys,coll:_i,tuple:vi};function bn(e){return e.code>=h.coll.simpleCollTypeCode&&e.code<=h.coll.nestedCollTypeCode+qs}function Zs(e){return e.code>=h.tuple.pairOneTypeCode&&e.code<=h.tuple.genericTupleTypeCode}function Fe(e){switch(e){case h.bool.code:return h.bool;case h.byte.code:return h.byte;case h.short.code:return h.short;case h.int.code:return h.int;case h.long.code:return h.long;case h.bigInt.code:return h.bigInt;case h.groupElement.code:return h.groupElement;case h.sigmaProp.code:return h.sigmaProp;default:throw new Error(`The type code '0x${e.toString(16)}' is not a valid primitive type code.`)}}var Ut=class extends $s{get code(){return h.coll.code}coerce(e){return this.elementsType.code===h.byte.code&&!(e instanceof Uint8Array)?typeof e=="string"?M.decode(e):Uint8Array.from(e):e.map(t=>this.elementsType.coerce(t))}toString(){return`SColl[${this.elementsType.toString()}]`}},wt=class extends $s{get code(){return h.tuple.code}coerce(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=this.elementsType[n].coerce(e[n]);return t}toString(){return`(${this.elementsType.map(e=>e.toString()).join(", ")})`}};function pe(e,t,n){return new Proxy(e,{apply:(s,o,r)=>{const i=t??new s;return!n&&W(r)?i:new We(i,...r)}})}function Js(e,t){return new Proxy(e,{apply:t})}var K=pe(zs,h.byte);pe(js,h.bool);pe(Xs,h.short);pe(Vs,h.int);var Ot=pe(Gs,h.long);pe(Ks,h.bigInt);pe(Qs,h.groupElement);pe(Ws,h.sigmaProp);pe(Ys,void 0,!0);var F=Js(Ut,(e,t,n)=>{const[s,o]=n,r=s();return o?new We(new e(r),o):()=>new e(r)});Js(wt,(e,t,n)=>{const[s,o]=n;if(typeof s=="function"&&typeof o=="function")return()=>new e([s(),o()]);if(s instanceof We&&o instanceof We)return new We(new e([s.type,o.type]),[s.data,o.data]);throw new Error("Invalid tuple declaration.")});var Ri=33,Kn=205,xt={serialize(e,t,n){if(t.embeddable)switch(t.code){case h.bool.code:return n.writeBool(e);case h.byte.code:return n.write(e);case h.short.code:return n.writeI16(e);case h.int.code:return n.writeI32(e);case h.long.code:return n.writeI64(e);case h.bigInt.code:return n.writeI256(e);case h.groupElement.code:return n.writeBytes(e);case h.sigmaProp.code:{const s=e;if(s.type===h.groupElement)return n.write(Kn),xt.serialize(s.data,s.type,n);throw Error("Serialization error: SigmaProp operation not implemented.")}}if(bn(t))switch(t.elementsType.code===h.byte.code?de(e instanceof Uint8Array,`SColl[Byte] expected an UInt8Array, got ${typeof e}.`):de(Array.isArray(e),`SColl expected an array, got ${typeof e}.`),n.writeVLQ(e.length),t.elementsType.code){case h.bool.code:return n.writeBits(e);case h.byte.code:return n.writeBytes(e);default:{for(let s=0;s<e.length;s++)xt.serialize(e[s],t.elementsType,n);return n}}if(Zs(t)){de(Array.isArray(e),`STupleType serialization expected an array, got ${typeof e}.`);const s=t.elementsType.length;for(let o=0;o<s;o++)xt.serialize(e[o],t.elementsType[o],n);return n}if(t.code===h.unit.code)return n;throw Error(`Serialization error: '0x${t.code.toString(16)}' type not implemented.`)},deserialize(e,t){if(e.embeddable)switch(e.code){case h.bool.code:return t.readBool();case h.byte.code:return t.readI8();case h.short.code:return t.readI16();case h.int.code:return t.readI32();case h.long.code:return t.readI64();case h.bigInt.code:return t.readI256();case h.groupElement.code:return t.readBytes(Ri);case h.sigmaProp.code:{if(t.readByte()===Kn)return this.deserialize(h.groupElement,t);break}}else switch(e.code){case h.coll.code:{const n=t.readVlq(),s=e.elementsType;switch(s.code){case h.bool.code:return t.readBits(n);case h.byte.code:return t.readBytes(n);default:{const o=new Array(n);for(let r=0;r<n;r++)o[r]=this.deserialize(s,t);return o}}}case h.tuple.code:return e.elementsType.map(n=>this.deserialize(n,t));case h.unit.code:return}throw new Error(`Parsing error: '0x${e.code.toString(16)}' type not implemented.`)}},Qn={serialize(e,t){if(e.embeddable)t.write(e.code);else if(e.code===h.unit.code)t.write(e.code);else if(bn(e))if(e.elementsType.embeddable)t.write(h.coll.simpleCollTypeCode+e.elementsType.code);else if(bn(e.elementsType)){const n=e.elementsType;n.elementsType.embeddable?t.write(h.coll.nestedCollTypeCode+n.elementsType.code):(t.write(h.coll.simpleCollTypeCode),this.serialize(n,t))}else t.write(h.coll.simpleCollTypeCode),this.serialize(e.elementsType,t);else if(Zs(e)){switch(e.elementsType.length){case 2:{const n=Ye(e.elementsType),s=Jo(e.elementsType);n.embeddable?n.code===s.code?t.write(h.tuple.symmetricPairTypeCode+n.code):(t.write(h.tuple.pairOneTypeCode+n.code),this.serialize(s,t)):s.embeddable?(t.write(h.tuple.pairTwoTypeCode+s.code),this.serialize(n,t)):(t.write(h.tuple.pairOneTypeCode),this.serialize(n,t),this.serialize(s,t));return}case 3:t.write(h.tuple.tripleTypeCode);break;case 4:t.write(h.tuple.quadrupleTypeCode);break;default:{const n=e.elementsType.length;de(n>=2&&n<=255,"Invalid type: tuples must have between 2 and 255 items."),t.write(h.tuple.genericTupleTypeCode),t.writeVLQ(n)}}for(let n=0;n<e.elementsType.length;n++)this.serialize(e.elementsType[n],t)}else throw new Error("Serialization error: type not implemented.")},deserialize(e){const t=e.readByte();if(de(t>0,`Parsing Error: Unexpected type code '0x${t.toString(16)}'`),t<h.tuple.genericTupleTypeCode){const n=Math.floor(t/gn),s=Math.floor(t%gn);switch(n){case O.embeddable:return Fe(s);case O.simpleColl:{const o=s===0?this.deserialize(e):Fe(s);return new Ut(o)}case O.nestedColl:return new Ut(new Ut(Fe(s)));case O.pairOne:{const o=s===0?[this.deserialize(e),this.deserialize(e)]:[Fe(s),this.deserialize(e)];return new wt(o)}case O.pairTwo:{const o=s===0?[this.deserialize(e),this.deserialize(e),this.deserialize(e)]:[this.deserialize(e),Fe(s)];return new wt(o)}case O.symmetricPair:{const o=s===0?[this.deserialize(e),this.deserialize(e),this.deserialize(e),this.deserialize(e)]:[Fe(s),Fe(s)];return new wt(o)}}}switch(t){case h.tuple.genericTupleTypeCode:{const n=e.readVlq(),s=new Array(n);for(let o=0;o<n;o++)s[o]=this.deserialize(e);return new wt(s)}case h.unit.code:return h.unit}throw new Error("Not implemented.")}},Bi=4096,Rt,Bt,nt,We=(nt=class{constructor(t,n){T(this,Rt);T(this,Bt);p(this,Rt,t),p(this,Bt,t.coerce(n))}static from(t){de(t.length>0,"Empty constant bytes.");const n=new Ei(t),s=Qn.deserialize(n),o=xt.deserialize(s,n);return new nt(s,o)}get type(){return d(this,Rt)}get data(){return d(this,Bt)}toBytes(){const t=new Qt(Bi);return Qn.serialize(this.type,t),xt.serialize(this.data,this.type,t),t.toBytes()}toHex(){return M.encode(this.toBytes())}},Rt=new WeakMap,Bt=new WeakMap,nt);function Ne(e,t="strict"){if(t==="strict")return We.from(e??"").data;if(e)try{return We.from(e).data}catch{return}}var Ai=65535;function mn(e,t=new Qt(4096),n){if(t.writeBigVLQ(H(e.value)),t.writeHex(e.ergoTree),t.writeVLQ(e.creationHeight),Li(t,e.assets,n),Si(t,e.additionalRegisters),B(n))return t;if(!eo(e))throw new Error("Invalid box type.");return t.writeHex(e.transactionId).writeVLQ(e.index)}function eo(e){const t=e;return B(t.transactionId)&&B(t.index)}function Li(e,t,n){if(W(t)){e.write(0);return}e.writeVLQ(t.length),D(n)?t.map(s=>e.writeVLQ(n.indexOf(s.tokenId)).writeBigVLQ(H(s.amount))):t.map(s=>e.writeHex(s.tokenId).writeBigVLQ(H(s.amount)))}function Si(e,t){const n=Object.keys(t).sort();let s=0;for(const o of n)t[o]&&s++;if(e.writeVLQ(s),s!==0)for(const o of n){const r=t[o];B(r)&&e.writeHex(r)}}function Ci(e,t){if(C(e.creationHeight))throw new Error("Box size estimation error: creation height is undefined.");let n=0;n+=N(B(t)?t:e.value),n+=It(e.ergoTree),n+=N(e.creationHeight),n+=N(e.assets.length);for(const o of e.assets)n+=It(o.tokenId)+N(o.amount);let s=0;for(const o in e.additionalRegisters){const r=e.additionalRegisters[o];r&&(n+=It(r),s++)}return n+=N(s),n+=32,n+=N(eo(e)?e.index:Ai),n}function Pi(e){const t=new Qt(1e5);t.writeVLQ(e.inputs.length),e.inputs.map(s=>Oi(t,s)),t.writeVLQ(e.dataInputs.length),e.dataInputs.map(s=>t.writeHex(s.boxId));const n=Ni(e.outputs);return t.writeVLQ(n.length),n.map(s=>t.writeHex(s)),t.writeVLQ(e.outputs.length),e.outputs.map(s=>mn(s,t,n)),t}function Oi(e,t){e.writeHex(t.boxId),e.write(0),Hi(e,t.extension)}function Hi(e,t){const n=Object.keys(t);let s=0;for(const o of n)B(t[o])&&s++;if(e.writeVLQ(s),s!==0)for(const o of n){const r=t[o];B(r)&&e.writeVLQ(Number(o)).writeHex(r)}}function Ni(e){const t=new Set;return e.flatMap(n=>n.assets.map(s=>t.add(s.tokenId))),Array.from(t)}var Di=class extends Error{constructor(){super("One or more inputs was selected more than one time by the current selection strategy.")}},Ui=class extends Error{constructor(t){const n=[];if(t.nanoErgs&&n.push(Wn("nanoErgs",t.nanoErgs)),D(t.tokens))for(const s of t.tokens)n.push(Wn(s.tokenId,s.amount));super(`Insufficient inputs:${n.join()}`);A(this,"unreached");this.unreached=t}};function Wn(e,t){return`
  > ${e}: ${t==null?void 0:t.toString()}`}var Fi=class{constructor(){A(this,"_inputs")}select(e,t){this._inputs=e;let n=[];D(t.tokens)&&(n=this._selectTokens(t.tokens));const s=cn(n,o=>o.value);if(C(t.nanoErgs)&&W(t.tokens)||B(t.nanoErgs)&&s<t.nanoErgs){const o=B(t.nanoErgs)?t.nanoErgs-s:void 0;n=n.concat(this._select(o))}return n}_selectTokens(e){let t=[];for(const n of e){const s=B(n.amount)?n.amount-me(t,n.tokenId):void 0;s&&s<=_||(t=t.concat(this._select(s,n.tokenId)))}return t}_select(e,t){const n=this._inputs;let s=_,o=[];if(C(e))t?o=n.filter(r=>r.assets.some(i=>i.tokenId===t)):o=n;else for(let r=0;r<n.length&&s<e;r++)if(t)for(const i of n[r].assets)i.tokenId===t&&(s+=i.amount,o.push(n[r]));else s+=n[r].value,o.push(n[r]);return D(o)&&(this._inputs=this._inputs.filter(r=>!o.includes(r))),o}},Mi=class{constructor(e){A(this,"_selector");this._selector=e}select(e,t){return this._selector(e,t)}},$i=class{constructor(e){A(this,"_inputs");A(this,"_strategy");A(this,"_ensureFilterPredicate");A(this,"_selector");A(this,"_sortDirection");A(this,"_ensureInclusionBoxIds");this._inputs=e}defineStrategy(e){return this._isISelectionStrategyImplementation(e)?this._strategy=e:this._strategy=new Mi(e),this}select(e){var a;this._strategy||(this._strategy=new Fi);const t=this._deepCloneTarget(e);let n=[...this._inputs],s=[];const o=this._ensureFilterPredicate;let r=this._ensureInclusionBoxIds;if((a=e.tokens)!=null&&a.some(c=>c.tokenId===n[0].boxId)&&(r=new Set(this._ensureInclusionBoxIds).add(n[0].boxId)),o?s=r?n.filter(c=>o(c)||r.has(c.boxId)):n.filter(o):r&&(s=n.filter(c=>r.has(c.boxId))),D(s)&&(n=n.filter(c=>!s.some(f=>f.boxId===c.boxId)),t.nanoErgs&&t.nanoErgs>_&&(t.nanoErgs-=cn(s,c=>c.value)),D(t.tokens)&&s.some(c=>!W(c.assets))))for(const c of t.tokens)c.amount&&c.amount>_&&(c.amount-=me(s,c.tokenId));if(this._selector&&(n=sr(n,this._selector,this._sortDirection||"asc")),s=s.concat(this._strategy.select(n,t)),tr(s,c=>c.boxId))throw new Di;const i=this._getUnreachedTargets(s,e);if(i.nanoErgs||D(i.tokens))throw new Ui(i);return s}_deepCloneTarget(e){return{nanoErgs:e.nanoErgs,tokens:e.tokens?e.tokens.map(t=>({tokenId:t.tokenId,amount:t.amount})):void 0}}_getUnreachedTargets(e,t){const n={nanoErgs:void 0,tokens:void 0},s=cn(e,o=>o.value);if(t.nanoErgs&&t.nanoErgs>s&&(n.nanoErgs=t.nanoErgs-s),W(t.tokens))return n;for(const o of t.tokens){const r=me(e,o.tokenId);if(o.amount&&o.amount>r){if(o.tokenId===Ye(e).boxId)continue;C(n.tokens)&&(n.tokens=[]),n.tokens.push({tokenId:o.tokenId,amount:o.amount-r})}}return n}ensureInclusion(e){if(typeof e=="function")this._ensureFilterPredicate=e;else if(e==="all")this._ensureFilterPredicate=t=>t.value>0n;else if(C(this._ensureInclusionBoxIds)&&(this._ensureInclusionBoxIds=new Set),Array.isArray(e))for(const t of e)this._ensureInclusionBoxIds.add(t);else this._ensureInclusionBoxIds.add(e);return this}orderBy(e,t){return this._selector=e,this._sortDirection=t,this}_isISelectionStrategyImplementation(e){return!!e.select}static buildTargetFrom(e){const t={};let n=_;for(const s of e){n+=H(s.value);for(const o of s.assets)t[o.tokenId]=(t[o.tokenId]||_)+H(o.amount)}return{nanoErgs:n,tokens:Object.keys(t).map(s=>({tokenId:s,amount:t[s]}))}}},ji=class extends Error{constructor(e){super(`Box '${e}' is already included.`)}},zi=class extends Error{},Xi=class extends Error{constructor(e){super(`Invalid Ergo address: ${e}`)}},Vi=class extends Error{constructor(e){super(`Invalid input: ${e}`)}},Gi=class extends Error{constructor(){super("Registers should be densely packed. This means that it's not possible to use a register like 'R7' without filling 'R6', 'R5' and 'R4', for example.")}},Yn=class extends Error{constructor(e){super(`Malformed transaction: ${e}`)}},An=100,_e,ls,pn=(ls=class extends Rn{constructor(t,n){super();T(this,_e);B(t)&&this.add(t,n)}get minting(){if(d(this,_e))return{...d(this,_e).metadata,amount:this._items[d(this,_e).index].amount}}_map(t){return{tokenId:t.tokenId,amount:H(t.amount)}}_addOne(t,n){if((C(n)||n.sum&&C(n.index))&&this._sum(this._map(t)))return this.length;if(this._items.length>=An)throw new Ki;return super._addOne(t,n),this.length}add(t,n){if(Array.isArray(t)){if(t.some(s=>!s.tokenId))throw new Tt("TokenID is required.")}else if(!t.tokenId)throw new Tt("TokenID is required.");return super.add(t,n)}mint(t){if(B(d(this,_e)))throw new Tt("Only one minting token is allowed per transaction.");const n=super.add({tokenId:t.tokenId,amount:t.amount});return p(this,_e,{index:n-1,metadata:t}),this.length}_sum(t){for(const n of this._items)if(n.tokenId===t.tokenId)return n.amount+=t.amount,!0;return!1}remove(t,n){let s=-1;if(typeof t=="number"){if(this._isIndexOutOfBounds(t))throw new RangeError(`Index '${t}' is out of range.`);s=t}else if(s=this._items.findIndex(o=>o.tokenId===t),this._isIndexOutOfBounds(s))throw new Ln(`TokenId '${t}' not found in assets collection.`);if(n&&s>-1){const o=H(n),r=this._items[s];if(o>r.amount)throw new zi("Insufficient token amount to perform a subtraction operation.");if(o<r.amount)return r.amount-=o,this.length}return this._items.splice(s,1),this.length}contains(t){return this._items.some(n=>n.tokenId===t)}toArray(t){if(this.minting){if(!t)throw new Wi;return this._items.map(n=>({tokenId:n.tokenId?n.tokenId:t,amount:n.amount}))}return super.toArray()}},_e=new WeakMap,ls),Ki=class extends Error{constructor(){super(`A box must contain no more than ${An} distinct tokens.`)}},to=class extends Error{constructor(){super("This transaction is trying to burn tokens. If that's your intention you must explicitly allow token burning on TransactionBuilder.configure() method. If no, a change address should be provided.")}},Ln=class extends Error{},Qi=class extends Error{constructor(){super("Minting context is undefined. Transaction's inputs must be included in order to determine minting token id.")}},Wi=class extends Error{constructor(){super("Creation Height is undefined.")}},Et=4,Yi=32;function no(e){return Ye(e)&240}function so(e){return Ye(e)&15}function yn(e){return{head:e.subarray(0,1),body:e.subarray(1,e.length-Et),checksum:e.subarray(e.length-Et,e.length),network:no(e),type:so(e)}}function qn(e,t,n){return new Qt(1+n.length+Et).write(e+t).writeBytes(n).writeChecksum(Et).encode(tt)}function oo(e){const t=dn(e.head,e.body);if(W(e.body)||e.type===V.P2PK&&!Hs(e.body))return!1;const n=bt(t).subarray(0,Et);return or(n,e.checksum)}function qi(e){return oo(yn(tt.decode(e)))}var wn=M.decode("0008cd"),Zi=36,ro=M.decode("d40801"),Ft=M.decode("00ea02d193b4cbe4e3010e040004300e18"),Ji=44,Nt=24;function e0(e){return e.length===Zi&&$n(e,wn)?V.P2PK:e.length===Ji&&$n(e,Ft)&&rr(e,ro)?V.P2SH:V.P2S}var le,ve,st,At,P,In,z=(P=class{constructor(t,n=Kt.Mainnet){T(this,le);T(this,ve);T(this,st);p(this,le,t),p(this,ve,n),p(this,st,e0(t))}get network(){return d(this,ve)}get ergoTree(){return M.encode(d(this,le))}get type(){return d(this,st)}static fromErgoTree(t,n){return new P(ce(t),n)}static fromPublicKey(t,n){const s=ce(t);if(!Hs(s))throw new Error("The Public Key is invalid.");const o=dn(wn,s);return new P(o,n)}static fromHash(t,n){let s=ce(t);if(s.length===Yi)s=s.subarray(0,Nt);else if(s.length!==Nt)throw Error(`Invalid hash length: ${s.length}`);const o=dn(Ft,s,ro);return new P(o,n)}static decode(t){var o;const n=tt.decode(t),s=yn(n);if(!oo(s))throw new Xi(t);return se(o=P,At,In).call(o,s)}static decodeUnsafe(t){var n;return se(n=P,At,In).call(n,yn(tt.decode(t)))}static fromBase58(t,n=!1){return n?P.decodeUnsafe(t):P.decode(t)}static validate(t){return qi(t)}static getNetworkType(t){return no(tt.decode(t))}static getAddressType(t){return so(tt.decode(t))}getPublicKeys(){return this.type===V.P2PK?[d(this,le).subarray(wn.length)]:[]}toP2SH(t){if(this.type===V.P2SH)return this.encode();const n=bt(d(this,le)).subarray(0,Nt);return qn(t??d(this,ve),V.P2SH,n)}encode(t){let n;return this.type===V.P2PK?n=Ye(this.getPublicKeys()):this.type===V.P2SH?n=d(this,le).subarray(Ft.length,Ft.length+Nt):n=d(this,le),qn(t??d(this,ve),d(this,st),n)}toString(t){return this.encode(t??d(this,ve))}},le=new WeakMap,ve=new WeakMap,st=new WeakMap,At=new WeakSet,In=function(t){switch(t.type){case V.P2PK:return P.fromPublicKey(t.body,t.network);case V.P2SH:return P.fromHash(t.body,t.network);case V.ADH:throw new Error("Invalid address type");default:return new P(t.body,t.network)}},T(P,At),P),Mt=class{constructor(e,t){A(this,"value");A(this,"ergoTree");A(this,"creationHeight");A(this,"assets");A(this,"additionalRegisters");A(this,"flags");this.ergoTree=e.ergoTree,this.creationHeight=e.creationHeight,this.value=H(e.value),this.assets=e.assets.map(n=>({tokenId:n.tokenId,amount:H(n.amount)})),this.additionalRegisters=e.additionalRegisters,this.flags=t}toBox(e,t){return new io(this,e,t)}toPlainObject(){return{value:this.value.toString(),ergoTree:this.ergoTree,creationHeight:this.creationHeight,assets:this.assets.map(e=>({tokenId:e.tokenId,amount:e.amount.toString()})),additionalRegisters:this.additionalRegisters}}},X,$e,ot,rt,it,io=(it=class{constructor(t,n,s){T(this,X);T(this,$e);T(this,ot);T(this,rt);if(t0(t))p(this,X,new Mt(t)),p(this,ot,t.transactionId),p(this,rt,t.index),p(this,$e,t.boxId);else{if(!n||C(s))throw new Tt("TransactionId and Index must be provided for Box generation.");p(this,X,t instanceof Mt?t:new Mt(t)),p(this,ot,n),p(this,rt,s)}}get value(){return d(this,X).value}get ergoTree(){return d(this,X).ergoTree}get creationHeight(){return d(this,X).creationHeight}get assets(){return d(this,X).assets}get additionalRegisters(){return d(this,X).additionalRegisters}get boxId(){return d(this,$e)||p(this,$e,M.encode(bt(mn(this).toBytes()))),d(this,$e)}get transactionId(){return d(this,ot)}get index(){return d(this,rt)}get change(){var t;return!!((t=d(this,X).flags)!=null&&t.change)}toPlainObject(t){return t==="minimal"?{boxId:this.boxId}:{boxId:this.boxId,...d(this,X).toPlainObject(),transactionId:this.transactionId,index:this.index}}toCandidate(){return d(this,X)}isValid(){return it.validate(this)}static validate(t){const n=mn(t).toBytes(),s=M.encode(bt(n));return t.boxId===s}},X=new WeakMap,$e=new WeakMap,ot=new WeakMap,rt=new WeakMap,it);function t0(e){const t=e;return!!t.boxId&&!!t.transactionId&&B(t.index)}var Lt,hs,Zn=(hs=class extends io{constructor(t){super(t);T(this,Lt);t.extension&&this.setContextExtension(t.extension)}get extension(){return d(this,Lt)||{}}setContextExtension(t){const n={};for(const s in t){const o=t[s];o&&(n[s]=typeof o=="string"?o:o.toHex())}return p(this,Lt,n),this}setContextVars(t){return this.setContextExtension(t)}toPlainObject(t){return{...super.toPlainObject(t),extension:this.extension}}toDataInputPlainObject(t){return super.toPlainObject(t)}},Lt=new WeakMap,hs),at,gs,Jn=(gs=class{constructor(e){T(this,at);p(this,at,e)}first(){return d(this,at)}toArray(){let e=d(this,at);const t=[e];for(;e.child;)t.push(e.child),e=e.child;return t}toEIP12Object(){return this.toArray().map(e=>e.toEIP12Object())}toPlainObject(){return this.toArray().map(e=>e.toPlainObject())}},at=new WeakMap,gs),St,Ct,Re,je,ct,dt,ut,ae,bs,n0=(bs=class{constructor(e,t,n,s){T(this,St);T(this,Ct);T(this,Re);T(this,je);T(this,ct);T(this,dt);T(this,ut);T(this,ae);p(this,St,e),p(this,Ct,t),p(this,Re,n),p(this,ae,s)}get id(){return d(this,ut)||p(this,ut,M.encode(bt(this.toBytes()))),d(this,ut)}get inputs(){return d(this,St)}get dataInputs(){return d(this,Ct)}get outputs(){return d(this,ct)||p(this,ct,d(this,Re).map((e,t)=>e.toBox(this.id,t))),d(this,ct)}get change(){return d(this,dt)||p(this,dt,this.outputs.filter(e=>e.change)),d(this,dt)}get burning(){const e=Dt(me(this.inputs),me(d(this,Re)));return e.tokens.length>0&&(e.tokens=e.tokens.filter(t=>t.tokenId!==this.inputs[0].boxId)),e}get child(){return d(this,je)}chain(e){if(!d(this,ae))throw new Tt("Cannot chain transactions without a parent TransactionBuilder");const t=d(this,ae).creationHeight,n=new Q(t).from(this.change);d(this,ae).fee&&n.payFee(d(this,ae).fee),d(this,ae).changeAddress&&n.sendChangeTo(d(this,ae).changeAddress);const s=e(n,this);return s instanceof Q?p(this,je,s.build()):s instanceof Jn?p(this,je,s.first()):p(this,je,s),new Jn(this)}toPlainObject(e){return{inputs:this.inputs.map(t=>t.toPlainObject(e??"minimal")),dataInputs:this.dataInputs.map(t=>t.toDataInputPlainObject(e??"minimal")),outputs:d(this,Re).map(t=>t.toPlainObject())}}toEIP12Object(){return this.toPlainObject("EIP-12")}toBytes(){return Pi({inputs:this.inputs,dataInputs:this.dataInputs,outputs:d(this,Re)}).toBytes()}},St=new WeakMap,Ct=new WeakMap,Re=new WeakMap,je=new WeakMap,ct=new WeakMap,dt=new WeakMap,ut=new WeakMap,ae=new WeakMap,bs),es=class extends Rn{constructor(e){super(),B(e)&&this.add(e)}_map(e){return e instanceof Zn?e:new Zn(e)}_addOne(e){if(this._items.some(t=>t.boxId===e.boxId))throw new ji(e.boxId);return super._addOne(e)}remove(e){let t=-1;if(typeof e=="number"){if(this._isIndexOutOfBounds(e))throw new RangeError(`Index '${e}' is out of range.`);t=e}else if(t=this._items.findIndex(n=>n.boxId===e),this._isIndexOutOfBounds(t))throw new Ln("The input you are trying to remove is not present in the inputs collection.");return this._items.splice(t,1),this.length}};function ts(e,t,n){return e.set(t,(e.get(t)||_)+n)}var s0=class ao extends Rn{constructor(t){super(),B(t)&&this.add(t)}_map(t){return t}remove(t){let n=-1;if(typeof t=="number"){if(this._isIndexOutOfBounds(t))throw new RangeError(`Index '${t}' is out of range.`);n=t}else if(n=this._items.lastIndexOf(t),this._isIndexOutOfBounds(n))throw new Ln("The output you are trying to remove is not present in the outputs collection.");return this._items.splice(n,1),this.length}clone(){return new ao(this._items)}sum(t){const n=new Map;let s=_;if(t&&(t.nanoErgs&&(s=t.nanoErgs),D(t.tokens)))for(const o of t.tokens)C(o.amount)||ts(n,o.tokenId,o.amount);for(const o of this._items){s+=o.value;for(const r of o.assets)r.tokenId&&ts(n,r.tokenId,r.amount)}return{nanoErgs:s,tokens:Array.from(n,([o,r])=>({tokenId:o,amount:r}))}}},o0=7,ze,Pt,ms,r0=(ms=class{constructor(e,t){T(this,ze);T(this,Pt);typeof e=="string"?p(this,ze,M.decode(e)):p(this,ze,e),p(this,Pt,t??Kt.Mainnet)}get header(){return d(this,ze)[0]}get version(){return this.header&o0}get hasSegregatedConstants(){return(this.header&zn.constantSegregation)!==0}get hasSize(){return(this.header&zn.sizeInclusion)!==0}toBytes(){return d(this,ze)}toHex(){return M.encode(this.toBytes())}toAddress(e){return z.fromErgoTree(this.toHex(),e??d(this,Pt))}encode(e){return this.toAddress(e).encode()}},ze=new WeakMap,Pt=new WeakMap,ms),co=BigInt(360),uo=BigInt(1e6);function i0(e=co){return t=>BigInt(t.estimateSize())*e}var a0="0000000000000000000000000000000000000000000000000000000000000000",Be,he,ft,Xe,Ve,lt,Ae,ps,L=(ps=class{constructor(e,t,n){T(this,Be);T(this,he);T(this,ft);T(this,Xe);T(this,Ve);T(this,lt);T(this,Ae,{change:!1});this.setValue(e),p(this,Ve,n),p(this,he,new pn),p(this,lt,{}),p(this,Ae,{change:!1}),typeof t=="string"?p(this,Be,_s(t)?z.fromErgoTree(t):z.fromBase58(t)):t instanceof r0?p(this,Be,t.toAddress()):p(this,Be,t)}get value(){return B(d(this,Xe))?d(this,Xe).call(this,this):d(this,ft)}get address(){return d(this,Be)}get ergoTree(){return d(this,Be).ergoTree}get creationHeight(){return d(this,Ve)}get assets(){return d(this,he)}get additionalRegisters(){return d(this,lt)}get minting(){return this.assets.minting}get flags(){return d(this,Ae)}setValue(e){if(typeof e=="function")p(this,Xe,e);else if(p(this,ft,H(e)),p(this,Xe,void 0),d(this,ft)<=_)throw new Error("An UTxO cannot be created without a minimum required amount.");return this}setFlags(e){return p(this,Ae,{...d(this,Ae),...e}),this}addTokens(e,t){return e instanceof pn?d(this,he).add(e.toArray(),t):d(this,he).add(e,t),this}addNfts(...e){const t=e.map(n=>({tokenId:n,amount:Ke}));return this.addTokens(t)}mintToken(e){return this.assets.mint(e),this}setCreationHeight(e,t){return(C(t)||t.replace===!0||t.replace===!1&&C(d(this,Ve)))&&p(this,Ve,e),this}setAdditionalRegisters(e){const t={};for(const n in e){const s=e[n];s&&(t[n]=typeof s=="string"?s:s.toHex())}if(!cr(t))throw new Gi;return p(this,lt,t),this}eject(e){return e({tokens:d(this,he)}),this}build(e){var n,s;let t;if(this.minting){const o=e?(n=e[0])==null?void 0:n.boxId:void 0;t=this.assets.toArray(o),W(this.additionalRegisters)&&this.setAdditionalRegisters({R4:F(K,nn.decode(this.minting.name||"")),R5:F(K,nn.decode(this.minting.description||"")),R6:F(K,nn.decode(((s=this.minting.decimals)==null?void 0:s.toString())||"0"))})}else t=this.assets.toArray();if(C(this.creationHeight))throw new Qi;return new Mt({value:this.value,ergoTree:this.ergoTree,creationHeight:this.creationHeight,assets:t,additionalRegisters:this.additionalRegisters},d(this,Ae))}estimateSize(e=uo){de(!!this.creationHeight,"Creation height must be set");const t={value:e,ergoTree:this.ergoTree,creationHeight:this.creationHeight,assets:d(this,he).toArray(a0),additionalRegisters:this.additionalRegisters};return Ci(t)}},Be=new WeakMap,he=new WeakMap,ft=new WeakMap,Xe=new WeakMap,Ve=new WeakMap,lt=new WeakMap,Ae=new WeakMap,ps),c0=class extends Error{};function d0(e){return{addInputs:t=>e.from(t,{ensureInclusion:!0}).inputs.length,addOutputs:(t,n)=>e.to(t,n).outputs.length,addDataInputs:(t,n)=>e.withDataFrom(t,n).dataInputs.length,burnTokens:t=>{if(!e.settings.canBurnTokensFromPlugins)throw new to;e.burnTokens(t)},setFee:t=>e.payFee(t)}}var u0=class{constructor(){A(this,"_maxDistinctTokensPerChangeBox");A(this,"_allowTokenBurning");A(this,"_allowTokenBurningFromPlugins");A(this,"_isolateErgOnChange");this._maxDistinctTokensPerChangeBox=An,this._allowTokenBurning=!1,this._allowTokenBurningFromPlugins=!1,this._isolateErgOnChange=!1}get maxTokensPerChangeBox(){return this._maxDistinctTokensPerChangeBox}get canBurnTokens(){return this._allowTokenBurning}get canBurnTokensFromPlugins(){return this.canBurnTokens||this._allowTokenBurningFromPlugins}get shouldIsolateErgOnChange(){return this._isolateErgOnChange}setMaxTokensPerChangeBox(e){return this._maxDistinctTokensPerChangeBox=e,this}allowTokenBurning(e=!0){return this._allowTokenBurning=e,this}allowTokenBurningFromPlugins(e=!0){return this._allowTokenBurningFromPlugins=e,this}isolateErgOnChange(e=!0){return this._isolateErgOnChange=e,this}},f0=BigInt(11e5),l0="1005040004000e36100204a00b08cd0279be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798ea02d192a39a8cc7a701730073011001020402d19683030193a38cc7b2a57300000193c2b2a57301007473027303830108cdeeac93b1a57304",ht,gt,ge,Le,G,be,Se,q,Ge,Z,Ce,$,fo,Tn,lo,ho,go,bo,ys,Q=(ys=class{constructor(e){T(this,$);T(this,ht);T(this,gt);T(this,ge);T(this,Le);T(this,G);T(this,be);T(this,Se);T(this,q);T(this,Ge);T(this,Z);T(this,Ce);p(this,ht,new es),p(this,gt,new es),p(this,ge,new s0),p(this,Le,new u0),p(this,G,e)}get inputs(){return d(this,ht)}get dataInputs(){return d(this,gt)}get outputs(){return d(this,ge)}get changeAddress(){return d(this,q)}get fee(){return d(this,Ge)}get burning(){return d(this,Z)}get settings(){return d(this,Le)}get creationHeight(){return d(this,G)}get and(){return this}atHeight(e){return p(this,G,e),this}from(e,t={ensureInclusion:!1}){const n=h0(e)?e.toArray():e;return t.ensureInclusion&&se(this,$,fo).call(this,n),d(this,ht).add(n),this}to(e,t){return d(this,ge).add(e,t),this}withDataFrom(e,t){return d(this,gt).add(e,t),this}sendChangeTo(e){return typeof e=="string"?p(this,q,_s(e)?z.fromErgoTree(e,Kt.Mainnet):z.fromBase58(e)):p(this,q,e),this}payFee(e){return p(this,Ge,H(e)),this}payMinFee(){return this.payFee(f0),this}burnTokens(e){return d(this,Z)||p(this,Z,new pn),d(this,Z).add(e),this}configure(e){return e(d(this,Le)),this}configureSelector(e){return C(d(this,Se))&&p(this,Se,[]),d(this,Se).push(e),this}extend(e){return d(this,Ce)||p(this,Ce,[]),d(this,Ce).push({execute:e,pending:!0}),this}eject(e){return e({inputs:this.inputs,dataInputs:this.dataInputs,outputs:this.outputs,burning:this.burning,settings:this.settings,selection:t=>{this.configureSelector(t)}}),this}build(){var a;if(D(d(this,Ce))){const c=d0(this);for(const f of d(this,Ce))f.pending&&(f.execute(c),f.pending=!1)}if(se(this,$,lo).call(this)){if(se(this,$,go).call(this))throw new Yn("only one token can be minted per transaction.");if(se(this,$,bo).call(this))throw new c0("EIP-4 tokens cannot be minted from outside of the minting box.")}this.outputs.toArray().map(c=>c.setCreationHeight(d(this,G),{replace:!1}));const e=this.outputs.clone();B(d(this,Ge))&&e.add(new L(d(this,Ge),l0));const t=new $i(this.inputs.toArray());if((a=d(this,be))!=null&&a.size&&t.ensureInclusion(Array.from(d(this,be))),D(d(this,Se)))for(const c of d(this,Se))c(t);const n=D(d(this,Z))?e.sum({tokens:d(this,Z).toArray()}):e.sum();let s=t.select(n);if(B(d(this,q))){const c=[],f=s[0].boxId,g=n.tokens.some(m=>m.tokenId===f)?f:void 0;g&&(n.tokens=n.tokens.filter(m=>m.tokenId!==g));let u=Dt(me(s),n);if(D(u.tokens)){let m=ns({changeAddress:d(this,q),creationHeight:d(this,G),tokens:u.tokens,maxTokensPerBox:this.settings.maxTokensPerChangeBox,baseIndex:this.outputs.length+1});for(;m>u.nanoErgs;)s=t.select({nanoErgs:n.nanoErgs+m,tokens:n.tokens}),u=Dt(me(s),n),m=ns({changeAddress:d(this,q),creationHeight:d(this,G),tokens:u.tokens,maxTokensPerBox:this.settings.maxTokensPerChangeBox,baseIndex:this.outputs.length+1});const l=nr(u.tokens,d(this,Le).maxTokensPerChangeBox);for(const x of l){const y=new L(i0(),d(this,q)).setCreationHeight(d(this,G)).addTokens(x).setFlags({change:!0});u.nanoErgs-=y.value,c.push(y)}}if(u.nanoErgs>_)if(!c.length||this.settings.shouldIsolateErgOnChange)c.unshift(new L(u.nanoErgs,d(this,q)).setCreationHeight(d(this,G)).setFlags({change:!0}));else{const m=Ye(c);m.setValue(m.value+u.nanoErgs)}e.add(c)}for(const c of s)if(!c.isValid())throw new Vi(c.boxId);const o=e.toArray().map(c=>c.setCreationHeight(d(this,G),{replace:!1}).build(s)),r=new n0(s,this.dataInputs.toArray(),o,this);let i=r.burning;if(i.nanoErgs>_)throw new Yn("it's not possible to burn ERG.");if(D(i.tokens)&&D(d(this,Z))&&(i=Dt(i,{nanoErgs:_,tokens:d(this,Z).toArray()})),!d(this,Le).canBurnTokens&&D(i.tokens))throw new to;return r}},ht=new WeakMap,gt=new WeakMap,ge=new WeakMap,Le=new WeakMap,G=new WeakMap,be=new WeakMap,Se=new WeakMap,q=new WeakMap,Ge=new WeakMap,Z=new WeakMap,Ce=new WeakMap,$=new WeakSet,fo=function(e){if(d(this,be)||p(this,be,new Set),Array.isArray(e))for(const t of e)d(this,be).add(t.boxId);else d(this,be).add(e.boxId)},Tn=function(){for(const e of d(this,ge))if(e.minting)return e},lo=function(){return se(this,$,Tn).call(this)!==void 0},ho=function(){var e,t;return(t=(e=se(this,$,Tn).call(this))==null?void 0:e.minting)==null?void 0:t.tokenId},go=function(){let e=0;for(const t of d(this,ge))if(t.minting&&(e++,e>1))return!0;return!1},bo=function(){const e=se(this,$,ho).call(this);if(C(e))return!1;let t=0;for(const n of d(this,ge))if(n.assets.contains(e)&&(t++,t>1))return!0;return!1},ys);function h0(e){return e.toArray!==void 0}function ns(e){return BigInt(g0(e))*co}function g0({changeAddress:e,creationHeight:t,tokens:n,baseIndex:s,maxTokensPerBox:o}){const r=Math.ceil(n.length/o);let i=0;i+=N(uo),i+=It(e.ergoTree),i+=N(t),i+=N(0),i+=32,i=i*r;for(let a=0;a<r;a++)i+=N(s+a);for(const a of n)i+=It(a.tokenId)+N(a.amount);return n.length>o?n.length%o>0?(i+=N(o)*Math.floor(n.length/o),i+=N(n.length%o)):i+=N(o)*r:i+=N(n.length),i}const b0=9223372036854775807n,ye=1000000n,m0=1474560n,mo="9f83nJY4x9QkHmeek6PJMcTrf2xcaHAT3j5HD5sANXibXjMUixn",po="04000580a4e803040004000e2052cdac4eaeeade5c52056b1a5e6ccb5d5c04f81988b15afa27b93dd3b56d4cf905020201050004020402040404060404040204000e20302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc00504040205020100040205000500040405000500040405d00f040204000580897a050005000400050204020402040204040500050005000500050005000500050005000502040204020404050404040502040404020404040404000404040205020402040204020402050004020500040205020400050204020502050004000502040205020500d810d601db6501fed602b27201730000d603db63087202d6047301d605c2a7d606b2a5730200d607db63087206d608db6308a7d60992c1a77303d60ab2a4730400d60bb27203730500d60c9683030193c272027205938c720b017306938c720b027307d60d860283010273087309d60eb27208730a01720dd60fb27207730b01720dd6108c720f029595ed93b17203730c93b17201730dd801d611db6308b27201730e0096830401938cb27211730f0001e4c67202040e938cb2721173100001731193e4c6720206057312938cb272037313000273147315d807d611b5a4d901116394c272117205d612e4c67202050ed613db6308b2a5731600d61499b0dc0c0f721101d9011463b5db63087214d901164d0e938c72160172127317d90114414d0e9a8c7214018c8c72140202b0b57213d901144d0e938c72140172127318d90114414d0e9a8c7214018c8c72140202d615b27201731900d616e4c67215070ed61799b0b57213d901174d0e938c7217017216731ad90117414d0e9a8c7217018c8c72170202b0dc0c0f721101d9011763b5db63087217d901194d0e938c7219017216731bd90117414d0e9a8c7217018c8c72170202d19683030193e4c67202040e720496830201939a72149d9c72149cb2e4c672150411731c0099731db2e4c6b27201731e000811731f00732072179399b0dc0c0fb5a4d901186393c27218720501d9011863b5db63087218d9011a4d0e938c721a0172167321d90118414d0e9a8c7218018c8c72180202b0b57207d901184d0e938c72180172167322d90118414d0e9a8c7218018c8c72180202721793c2720672059596830401ed93c5a7c5720a937205c2b2a57323008f8c720e0272109472107324938c720e018c720f01d805d611b4a473259ab1a47326d612e4c67202050ed613b2a5732700d614db63087213d615e4c6b27201732800070ed19683040193e4c6720206057329968302019399b0dc0c0f721101d9011663b5db63087216d901184d0e938c7218017212732ad90116414d0e9a8c7216018c8c72160202b0b57214d901164d0e938c7216017212732bd90116414d0e9a8c7216018c8c7216020299b0b57214d901164d0e938c7216017215732cd90116414d0e9a8c7216018c8c72160202b0dc0c0f721101d9011663b5db63087216d901184d0e938c7218017215732dd90116414d0e9a8c7216018c8c721602029399b0b57207d901164d0e938c7216017212732ed90116414d0e9a8c7216018c8c72160202b0b57208d901164d0e938c7216017212732fd90116414d0e9a8c7216018c8c7216020299b0b57208d901164d0e938c72160172157330d90116414d0e9a8c7216018c8c72160202b0b57207d901164d0e938c72160172157331d90116414d0e9a8c7216018c8c72160202af7211d901166393c27216c272137209d802d611c67202040ed612c67202050e9593e4c6720206057332d805d613b2a5733300d614e47212d615db63087213d616b27215733400d617b27207733500d19683060193c2721372059683030193e47211e4c67213040e937214e4c67213050e93e4c6721306057336968302019683030193b172157337938c7216017214938c721602733896830201938c721701e4c6720a070e938c7217028cb2720873390002938cb2db6308720a733a00017204720c7209d80ad613b27207733b00d6148c721302d615b27201733c00d616b2e4c672150411733d00d6179372147216d618e4c67215070ed619938c7213017218d61a9972148cb27208733e01720d02d61be47212d61ce47211d19683080196830201957217d801d61db27207733f0096830301938c721d027340938c721d018cb27208734100017219d802d61db27208734200d61eb272077343009683030193998c721d028c721e02721a938c721e018c721d0172199399b0b5db6308b2a5734400d9011d4d0e938c721d01721b7345d9011d414d0e9a8c721d018c8c721d0202b0b5db6308b2a4734600d9011d4d0e938c721d01721b7347d9011d414d0e9a8c721d018c8c721d0202721a968302017219938cb2db6308721573480001721c9683020193721ce4c67206040e93721be4c67206050e9572179683040193e4c6720606057349938cb27207734a0002734b938cb27207734c0002734d72179683030193e4c672060605734e938cb27207734f00027350948cb2720773510002735293c272067205720c720990b0b57207d9011d4d0e938c721d0172187353d9011d414d0e9a8c721d018c8c721d02027216",yo="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",p0="105404000e20"+yo+po,wo="1040040004020400040204040404040604060400040204000400040805020502050208cd024f716db88462f0c69b98d20cc281c0e51d6d1aa9ab79aa266e68b2eada18a18c0502040204020404040005000402050004040500040605000502058080b40105020402040204000400040204020404050204020402050204020404050004060402040204000404040005d00f0402040405000406040004020580a4e8030400040204020100d81fd601b2a4730000d602db63087201d603b27202730100d6048c720302d605b2a5730200d606db63087205d607b27206730300d6088c720702d6099372047208d60ab27202730400d60b8c720a02d60cb27206730500d60d8c720c02d60e93720b720dd60fb27202730600d6108c720f02d611b27206730700d6128c721102d6139372107212d614e4c6a7051ad615b27214730800d616e4c6a70811d617b27216730900d618c6a7070ed6198c720f01d61a96830a0193c27205c27201938cb27206730a00018cb27202730b0001938c7207018c720301938c720c018c720a01938c721101721993b17206730c93c17205c1720193c67205051ac67201051a93c67205060ec67201060e93c67205070ec67201070ed61b9683020193c672050411c67201041193c672050811c672010811d61c939a7204730d7208d61d96830301721c720e7213d61e968303017209720e93997210730e7212d61f968303017209720e939a7210730f721295968303017209720e7213731095968303019399720473117208720e7213d804d620b2a5731200d621e4c672200411d622b2db63087220731300d623b2a5731400d1968304019683070191b2722173150073169199b272217317007ea305731892b27221731900731a91b27221731b00731c938c722201c57201938c722202731d93c17220731e9683030193cbc27220721592c17223721793c27223e47218721a721b9596830301721c9399720b731f720d7213d806d620b2a4732000d621db63087220d622db6308a7d623b2a5732100d624db63087223d625b27224732200d19683040196830201938cb27221732300018cb272227324000193cbc2722072159683040193cbc27223b27214732500938c7225018cb2722273260001938c722502732793b27224732800b27221732900721a721b95968303017209939a720b732a720d7213d802d620b2a4732b00d621e4c67220091195ec93b2e4c672200411732c00732d968302018fb27221732e007ea3058fc17220b27221732f00d1ed721a721bd801d622b2a5733000d1968303019683020193c27222e47218938cb2db63087222733100029d9cb27221733200b272167333007334721a721b95721dd196830301721a721b721d95721ed805d620db6308b2a4733500d621b2a5733600d622db63087221d62393e4c6722106057337d624b2a5733800d196830501938cb27220733900018cb2db6308a7733a00019683080193c17221733b938cb27222733c00017219722392c17224721793c27224e4721893e4c67221040e8cb27220733d000193e4c67221050e8cb27222733e00017223721a721b721e95721fd196830301721f721a721bd1733f",Io="18dc4c1da4a0a91c08c0b7b85ccd46e0b2ab91396b38c8216406959356805e3b",Sn="10320404020105000400040405809bee02040004000e2018dc4c1da4a0a91c08c0b7b85ccd46e0b2ab91396b38c8216406959356805e3b040204000402040405020404040204020402040004000404040004040400040405d00f0e20302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc00502058080b40104020404040604060402040401010404040004040402040604020404040004020404040401000580897a058092a803d82ad601db6308a7d602b17201d6039172027300d604860283010273017302d605c6a70411d606e47205d607b27206730300d608ed7203938cb272017304017204027207d609c6a7080ed60ae67209d60bc1a7d60ceded7208720a92720b7305d60ddb6308b2a4730600d60e938cb2720d730700017308d60fb2720d730900d610b2a5730a00d611db63087210d612b27211730b00d613b27211730c00d614eded720eed939a8c720f02730d8c721202938c720f018c72120193b2720d730e007213d615c6a7060ed616e47215d617b2a5730f00d618db63087217d619c6a7051ad61ac6a7070ed61bb27206731000d61cb27201731100d61d917ea305721bd61ec672100411d61fc67210070ed620c67210051ad621b27201731200d622b27211731300d623c17210d624c2a7d625c27210d626c67210060ed627ef720ad62896830801937202b17211937221722293721c721293720b72239372247225937216e47226722797830301947205721e947219722094721a721fd629b1a5d62ab1721895ed720cef7214d806d62bb2a5731400d62cb2db6308722b731500d62db27201731600d62eb27218731700d62fe4c672170911d6309d9c7207b272067318007319d19683060196830301938c722c018c722d01938c722c028c722d0293c2722b721696830301938c722e01731a938c722e02731b93c17217731c9683050193c672170411720593c67217051a721993c67217060e721593c67217070e721a93c67217080e72099683030193b2722f731d009a7207723093b2722f731e00723093b2722f731f009a721bb27206732000720e93b27218732100721c95ed721def7208d196830301720e721d9572038f8cb272017322000272077323957214d801d62b93c2b2a4732400721695720cd19683040193c27217e47209722b93b27218732500b272017326007214d196830201722b7214957228d19683050196830401937205721e93721a721f937212721cefe6c67210080e93b17206b1e4721e93b1e47219b1e47220722893c2b2a473270072169596830201917229732891722a7329d195917229732a96830b01937202722a937221b27218732b0093721cb27218732c0093b27201732d017204b27218732e01720493720bc17217937224c27217937216e4c67217060e7227937205c672170411937219c67217051a93721ac67217070e732fd801d62bed7227720e95722bd196830301722b93c1721799720b733093c272177216d196830401e6c67210080e96830201938c721301e4721a938c72130272079683070193721e72059372207219937226721593721f721a93722572249372227221937212721c9272237331",To="a624c7e51ffae8f16fe024d8556faf47aac1c7fcaa7f584b95e9784e6426f630",Cn="10370404040404000402040004000402040204080e20302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc004020400040004020404040405000404040004000402040404060406058080b401040805d00f05d00f050005d00f050204000580897a05020100040004000404020105000400040404040400040204000404040005809ba204010104020400040404040100d815d601e4c6a70411d602b27201730000d603e4c6a70911d604b27203730100d605db6308a7d606b2a5730200d607e4c672060911d608b27203730300d60993e4c6720604117201d60a93e4c67206051ae4c6a7051ad60b93e4c67206060ee4c6a7060ed60ce4c6a7070ed60d93e4c67206070e720cd60ee4c6a7080ed60f93e4c67206080e720ed61093c27206c2a7d611db63087206d61293b27211730400b27205730500d61393b27211730600b27205730700d614b27203730800d61573099593b1a4730ad809d616b2db6501fe730b00d617b2e4c672160811730c00d618b2a5730d00d6199591b17205730e8cb27205730f00027310d61ab2a5731100d61bc67216070ed61c96830d017209720a720b720d720f93b27207731200b2720373130093b27207731400720893b27207731500720493b27207731600b2720373170072107212721393c172067318d61d93b272077319009a72147219d61e9d9c9d9c72197202731a7217731b95ec937202731c8f9d9c72047217731d731ed801d61fb2db63087218731f00d196830401721c721d96830301938c721f01720c93c27218720e938c721f0272199683020193c2721ae4721b93c1721a7320958f721e7321d17322d802d61fb2db63087218732300d620b2db6308721a732400d196830401721c721d96830301938c721f01720c93c27218720e938c721f02997219721e96830301938c722001720c93c2721ae4721b938c722002721ed805d61691b172057325d617860283010273267327d618957216ededed938cb272057328017217017215938cb27205732901721701720c8f8cb27205732a0172170299720872148f72147208ed938cb27205732b0172170172158f72147208d619b2a4732c00d61a9572169a8cb2db63087219732d00028cb27205732e00028cb2db63087219732f0002957218d801d61b9683040192c1720673307331968309017209720a720b720d720f937207720372107212721372189591721a7208d803d61cb2db6308b2a5733200733300d61d9972087214d61eb27211733400d19683030196830201938c721c0299721a721d938c721c01720c96830201938c721e02721d938c721e01720c721bd801d61cb27211733500d19683020196830201938c721c02721a938c721c01720c721bd17336",xo="302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc0",ko="52cdac4eaeeade5c52056b1a5e6ccb5d5c04f81988b15afa27b93dd3b56d4cf9",Eo="101504000e20302e93e8a379fb7bd750567947d0a396f2b138b51781e743457ee206e5b8ecc00400040002010500040204040404050004000400040204040400040401000400040004e8020100d806d601b2a4730000d602db63087201d6037301d604b2a5730200d605e4c6a7050ed60693c27204720595938cb27202730301860283010273047305017203d804d607b2e4c672010911730600d6089591b1720273078cb27202730800027309d609eded93e4c6a7040ec572019172077208938cb27202730a00017203d60a9a72088cb2db6308a7730b00029572099591720a7207d801d60bb2a5730c00d1eded938cb2db63087204730d0002720796830201938cb2db6308720b730e000299720a720793c2720b72057209d1ed7209938cb2db63087204730f0002720ad17310957206d802d607b2db63087204731100d608b27202731200d1ed96830301938c7207018c720801938c7207028c72080292a39a8cc7a70173137206d17314",y0="100a040004000580897a04e802040204000e2018dc4c1da4a0a91c08c0b7b85ccd46e0b2ab91396b38c8216406959356805e3b04000e20a624c7e51ffae8f16fe024d8556faf47aac1c7fcaa7f584b95e9784e6426f630058080b401d803d601b2a5730000d602c27201d603e4c6a7060e959372027203d801d604b2a4730100d19683030192c1720199c172047302937202e4c67204060e92a39a8cc7a7017303d801d604b2a5730400d196830801938cb2db63087201730500017306938cb2db6308720473070001730893e4c672040411e4c6a7041193e4c67204051ae4c6a7051a93e4c67204060e720393e4c67204070ee4c6a7070e93c172047309efe6c672040807",mt=[{tokenId:"0000000000000000000000000000000000000000000000000000000000000000",decimals:9,name:"Ergo",ticker:"ERG",project:"Ergoplatform",description:"Ergoplatform native coin",defaultAmount:10000000000n},{tokenId:"03faf2cb329f2e90d6d23b58d91bbb6c046aa143261cc21f52fbe2824bfcbf04",decimals:2,name:"SigmaUSD",ticker:"SigUSD",project:"Sigma USD",description:"Algorithmic stablecoin",defaultAmount:1000n},{tokenId:"f60bff91f7ae3f3a5f0c2d35b46ef8991f213a61d7f7e453d344fa52a42d9f9a",decimals:2,name:"Test SigUSD",ticker:"TestUSD",project:"Test",description:"Algorithmic stablecoin",defaultAmount:1000n},{tokenId:"6ba45eb59947c2b7a19ec6cff038080776e2303c328b321832d32924dfc297c2",decimals:0,name:"Exle: TestSigUSD",ticker:"ExleTestUSD",project:"Exle",description:"Tokens to use in place of SigUSD for testing Exle loans. This value is not pegged to anything and holds no value",defaultAmount:1000n}];function ta(e){return mt.find(t=>t.ticker==e)}function na(e){var t;return((t=mt.find(n=>n.tokenId==e))==null?void 0:t.ticker)??"???"}function w0(e){return mt.find(t=>t.tokenId==e).decimals}function sa(e){return mt.find(t=>t.ticker==e).decimals}function Wt(e,t){const n=e.additionalRegisters[t];if(n)return Ne(n)}function rn(e,t){const n=e.additionalRegisters[t];if(n)return Buffer.from(Ne(n)).toString("hex")}function _o(e){const t=e.additionalRegisters.R4;if(t)return Buffer.from(Ne(t)).toString("hex")}function Yt(e){const t=/"(value|amount)"\s*:\s*(-?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?)\s*([,\}\]])/g,n=e.replace(t,'"$1":"$2"$3');return JSON.parse(n)}function Vt(e){if(e===0n)return 0;const t=720n,n=Number((e+t-1n)/t);return n<0?0:n}function oa(e){return z.fromBase58(e).getPublicKeys().length>0}function vo(e){return z.fromErgoTree(e).getPublicKeys().length>0}function Ro(e){const t=e.additionalRegisters.R7;if(vo(t))return mt.find(n=>n.ticker=="ERG");if(t){const n=Buffer.from(Ne(t)).toString("hex");return mt.find(s=>s.tokenId==n)}}async function Bo(){const t="http://localhost:9053/info";try{const n=await fetch(t,{headers:{accept:"application/json"}});if(!n.ok){const o=await n.text();return console.error(`[GET /info] HTTP Error ${n.status}: ${o}`),null}return await n.json()}catch(n){return console.error("[GET /info] Request failed:",n),null}}async function ss(e){const t=`http://localhost:9053/blockchain/transaction/byId/${e}`;try{const n=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!n.ok){const r=await n.text();throw new Error(`HTTP ${n.status}: ${r}`)}const s=await n.text();return Yt(s)}catch(n){return console.error(`Failed to fetch transaction by ID (${e}):`,n),null}}async function os(e,t=0,n=100){const o=`http://localhost:9053/blockchain/box/byTokenId/${e}?offset=${t}&limit=${n}`;try{const r=await fetch(o,{headers:{accept:"application/json"}});if(!r.ok){const c=await r.text();return console.error(`[box/byTokenId] HTTP Error ${r.status}: ${c}`),[]}const i=await r.text();return Yt(i).items}catch(r){return console.error("[box/byTokenId] Request failed:",r),[]}}async function kt(e,t=0,n=1){const o=`http://localhost:9053/blockchain/box/unspent/byTokenId/${e}?offset=${t}&limit=${n}&sortDirection=desc&includeUnconfirmed=true`;try{const r=await fetch(o,{headers:{accept:"application/json"}});if(!r.ok){const c=await r.text();return console.error(`[box/unspent/byTokenId] HTTP Error ${r.status}: ${c}`),[]}const i=await r.text(),a=Yt(i);return Array.isArray(a)?a:[]}catch(r){return console.error("[box/unspent/byTokenId] Request failed:",r),[]}}async function Pn(e){const n="http://localhost:9053/blockchain/box/unspent/byErgoTree?offset=0&limit=100&sortDirection=desc&includeUnconfirmed=true&excludeMempoolSpent=true";try{const s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){const i=await s.text();return console.error(`[box/unspent/byErgoTree] HTTP Error ${s.status}: ${i}`),[]}const o=await s.text(),r=Yt(o);return console.log({text:o}),console.log({data:r}),Array.isArray(r)?r:[]}catch(s){return console.error("[box/unspent/byErgoTree] Request failed:",s),[]}}function I0(){return Pn(Cn)}function T0(){return Pn(Sn)}async function yt(){return(await kt(Io))[0]}async function qe(e){return(await kt(e))[0]}function Ao(e){const t=Ho(e);return Pn(t)}async function x0(){const e=await Bo(),t=await kt(To,0,100),n=await kt(xo,0,100),s=await kt(ko,0,100),o=t.filter(pt),r=n.filter(_t),i=s.filter(J),a=[...o,...r].map(w=>w.assets[1].tokenId),c=i.map(_o),f=i.map(w=>w.assets[1].tokenId),g=(await Promise.all(f.map(w=>os(w,0,100)))).flatMap(w=>w);console.log({crowdfundHistoryBoxes:g});const u=g.map(w=>w.transactionId),m=await Promise.all(u.map(ss)),x=(await Promise.all(a.map(w=>os(w,0,100)))).flatMap(w=>w).map(w=>w.transactionId),y=await Promise.all(x.map(ss)),k={nodeInfo:e,loanBoxes:o,repaymentBoxes:r,crowdfundBoxes:i,loanIds:a,crowdfundLoanIds:c,crowdfundHistoryTxs:m,loanHistoryTxs:y};return console.log({allMetadata:k}),k}function Lo(e,t){if(e.assets.length<2||!e.additionalRegisters.R7)return;const n=Ro(e);if(!n)return;const s=Ze(e),o=Co(e),r=Po(e),{repaymentLevel:i,lockedAmount:a}=kn(e),c=Number(Number(r.repaymentAmount)/10**n.decimals).toFixed(2),f=Number(Number(r.repaidAmount)/10**n.decimals).toFixed(2);return{phase:"repayment",loanId:e.assets[1].tokenId,loanType:"Crowdloan",loanTitle:o[0],loanDescription:o.slice(1).join(`
`),repaymentPeriod:""+Vt(s.repaymentHeightLength),interestRate:`${(100/Number(s.interestRate)).toFixed(1)} %`,fundingGoal:c,fundingToken:n.ticker,fundedAmount:f+" "+n.ticker,fundedPercentage:Number(i),daysLeft:Vt(r.repaymentDeadlineHeight-BigInt(t.fullHeight)),creator:z.fromErgoTree(Oo(e)).toString(),isReadyForWithdrawal:a>0n,isRepayed:i==100n}}function So(e,t){if(e.assets.length<2||!e.additionalRegisters.R7)return;const n=Ro(e);if(!n)return;const s=Ze(e),o=Co(e),{fundedAmount:r,fundingLevel:i}=A0(e),a=Number(Number(s.fundingGoal)/10**n.decimals).toFixed(2);return{phase:"loan",loanId:e.assets[0].tokenId,loanType:"Solofund",loanTitle:o[0],loanDescription:o.slice(1).join(`
`),repaymentPeriod:""+Vt(s.repaymentHeightLength),interestRate:`${(100/Number(s.interestRate)).toFixed(1)} %`,fundingGoal:a,fundingToken:n.ticker,fundedAmount:r+" "+n.ticker,fundedPercentage:Number(i),daysLeft:Vt(s.deadlineHeight-BigInt(t.fullHeight)),creator:z.fromErgoTree(Oo(e)).toString(),isReadyForWithdrawal:i>=100n}}function Gt(e){var x;const t=e.inputs.find(rs),n=e.outputs.find(rs),s=e.inputs.find(pt),o=e.outputs.find(pt),r=e.inputs.find(_t),i=e.outputs.find(_t),a=e.inputs.find(is),c=e.outputs.find(is),f=e.inputs.find(xn),g=e.outputs.find(xn),u=e.inputs.find(J),m=e.outputs.find(J);let l="";if(t&&n)!s&&o&&(l="Create Lend",o.additionalRegisters.R7?(l="Create Lend | Tokens",a&&(l="PROXY: Create Lend | Tokens")):(l="Create Lend | Erg",a&&(l="PROXY: Create Lend | Erg"))),s&&i&&(l="Lend to Repayment",i.additionalRegisters.R9?l="Lend to Repayment | Tokens":l="Lend to Repayment | Erg"),s&&o&&m&&(x=e.outputs[2])!=null&&x.assets[1]&&e.outputs[2].assets[0].tokenId==ko&&(l="Create Crowdfund | Tokens");else{if(u&&m){const y=Pe(u),k=Pe(m);y?k?l=k>y?"Fund Crowdfund | Tokens":"Repayment Crowdfund | Tokens":l="Repayment Crowdfund | Tokens":k?l="Fund Crowdfund | Tokens":l=""}s&&o&&(l="Lend to Lend",o.additionalRegisters.R7&&!vo(o.additionalRegisters.R7)?l="Lend to Lend | Tokens":l="Lend to Lend | Erg"),r&&i&&(l="Repayment to Repayment",i.additionalRegisters.R9?l="Repayment to Repayment | Tokens":l="Repayment to Repayment | Erg"),r&&f&&i&&(l="PROXY: Repayment to Repayment",i.additionalRegisters.R9?l="PROXY: Repayment to Repayment | Tokens":l="PROXY: Repayment to Repayment | Erg"),c&&(l="PROXY Lend Initiation"),g&&(l="PROXY Repayment Initiation")}return l}function k0(e){const t=Gt(e);return E0(e,t)}function E0(e,t){if(t=="Lend to Repayment | Tokens"){const n="Borrower",s=e.inputs.find(pt),o=ee(s),{fundingGoal:r}=Ze(s);return{action:"🎉 Loan Funded",role:n,txId:e.id,timestamp:e.timestamp,amount:r,tokenId:o}}else{if(t=="Create Lend | Tokens")return{action:"Loan Created",role:"Borrower",txId:e.id,timestamp:e.timestamp,amount:void 0,tokenId:void 0};if(t=="PROXY Lend Initiation")return{action:"Loan Created",role:"Borrower",txId:e.id,timestamp:e.timestamp,amount:void 0,tokenId:void 0};if(t=="PROXY Repayment Initiation"){const n=e.outputs.find(xn);return{action:"Loan Repayment",role:"Borrower",txId:e.id,timestamp:e.timestamp,amount:R0(n),tokenId:B0(n)}}else if(t=="Repayment to Repayment | Tokens"){const n=e.inputs.find(_t),s=e.outputs.find(_t),{lockedAmount:o,repaymentLevel:r}=kn(n),{lockedAmount:i,repaymentLevel:a}=kn(s);if(r<a){const c=o-i;return{action:"Loan Repayment",role:"Lender",txId:e.id,timestamp:e.timestamp,amount:c,tokenId:ee(n)}}else{const c=(o-i)*-1n;return{action:"Loan Repayment",role:"Borrower",txId:e.id,timestamp:e.timestamp,amount:c,tokenId:ee(s)}}}else if(t=="Fund Crowdfund | Tokens"){const n=e.inputs.find(J),s=e.outputs.find(J);return{action:"Loan Crowdfunding",role:"Lender",txId:e.id,timestamp:e.timestamp,amount:(Pe(s)??0n)-(Pe(n)??0n),tokenId:cs(s)}}else if(t=="Repayment Crowdfund | Tokens"){const n=e.inputs.find(J),s=e.outputs.find(J);return{action:"Repayment Crowdfunding",role:"Lender",txId:e.id,timestamp:e.timestamp,amount:(Pe(n)??0n)-(Pe(s)??0n),tokenId:cs(s)}}else{if(t=="Create Crowdfund | Tokens")return e.inputs.find(J),e.outputs.find(J),{action:"Crowdfund Created",role:"Borrower",txId:e.id,timestamp:e.timestamp,amount:void 0,tokenId:void 0};if(t=="Lend to Lend | Tokens"){const n=e.outputs.find(pt);return{action:"Loan Funding",role:"Lender",txId:e.id,timestamp:e.timestamp,amount:qt(n),tokenId:ee(n)}}}}}function rs(e){var t,n;return e.ergoTree===wo&&((n=(t=e.assets)==null?void 0:t[0])==null?void 0:n.tokenId)===Io}function pt(e){var t,n,s;return e.ergoTree===Sn&&((n=(t=e.assets)==null?void 0:t[0])==null?void 0:n.tokenId)===To&&((s=e.assets[0])==null?void 0:s.amount)==1}function _t(e){var t,n,s;return e.ergoTree===Cn&&((n=(t=e.assets)==null?void 0:t[0])==null?void 0:n.tokenId)===xo&&((s=e.assets[0])==null?void 0:s.amount)==1}function J(e){return e.ergoTree.endsWith(po)}function is(e){return e.ergoTree==y0}function xn(e){return e.ergoTree==Eo}function _0(e){return Gt(e)}function $t(e,t){return!!(e.inputs.flatMap(n=>n.address).includes(t)||e.outputs.flatMap(n=>n.address).includes(t))}function Co(e){var n;const t=Ne(((n=e.additionalRegisters)==null?void 0:n.R5)??"");return Array.isArray(t)?t.map(s=>Buffer.from(s).toString("utf8")):[]}function Ze(e){const t=Wt(e,"R4");return{fundingGoal:BigInt(t[0]),deadlineHeight:BigInt(t[1]),interestRate:BigInt(t[2]),repaymentHeightLength:BigInt(t[3]),serviceFee:t[4]!==void 0?BigInt(t[4]):void 0}}function Po(e){const t=Wt(e,"R9");return{fundedHeight:BigInt(t[0]),repaymentAmount:BigInt(t[1]),interestAmount:BigInt(t[2]),repaymentDeadlineHeight:BigInt(t[3]),repaidAmount:BigInt(t[4])}}function Oo(e){const t=e.additionalRegisters.R6;if(t)return Buffer.from(Ne(t)).toString("hex")}function v0(e){const t=e.additionalRegisters.R8;if(t)return Buffer.from(Ne(t)).toString("hex")}function as(e){var t;return(t=e.assets[1])==null?void 0:t.tokenId}function On(e){return Wt(e,"R8")[1]}function ee(e){const t=e.additionalRegisters.R7;if(t)return Buffer.from(Ne(t)).toString("hex")}function qt(e){var s;const t=ee(e),n=(s=e.assets.find(o=>o.tokenId==t))==null?void 0:s.amount;if(n)return BigInt(n)}function Pe(e){var n;const t=(n=e==null?void 0:e.assets[2])==null?void 0:n.amount;if(t)return BigInt(t)}function cs(e){var n;const t=(n=e==null?void 0:e.assets[2])==null?void 0:n.tokenId;if(t)return t}function R0(e){var n;const t=(n=e==null?void 0:e.assets[0])==null?void 0:n.amount;if(t)return BigInt(t)}function B0(e){var n;const t=(n=e==null?void 0:e.assets[0])==null?void 0:n.tokenId;if(t)return t}function kn(e){let t=0n,n=0n;const{repaymentAmount:s,repaidAmount:o}=Po(e),r=qt(e),i=o*100n/s;return r&&(t=r,n=t*100n/s),{lockedAmount:t,lockedLevel:n,repaymentLevel:i}}function A0(e){let t=0n,n=0n;const{fundingGoal:s}=Ze(e),o=qt(e);return o&&(n=o,t=n*100n/s),{fundedAmount:n,fundingLevel:t}}function L0(e,t){const n=e.loanHistoryTxs,s=e.crowdfundHistoryTxs,o=e.loanIds,r=e.crowdfundLoanIds,i=o.filter(y=>!r.includes(y)),a=e.nodeInfo;s.filter(y=>$t(y,t)),n.filter(y=>$t(y,t));function c(y,k,w,E,v){const R=l(y,k,v),I=x(w,E,v),te=[];return R.forEach(([ne,we])=>{te.push({loanId:ne,type:"Solofund",amount:we})}),I.forEach(([ne,we])=>{te.push({loanId:ne,type:"Crowdloan",amount:we})}),te}const f=c(n,i,s,r,t),g=e.loanBoxes,u=e.repaymentBoxes;f.forEach(y=>{Object.assign(y,m(y.loanId,u,g,a))}),e.crowdfundBoxes;function m(y,k,w,E){const v=k.find(I=>as(I)==y),R=w.find(I=>as(I)==y);if(v){const I=Lo(v,E);return I!=null&&I.isRepayed?{status:"Fully Repaid",title:I.loanTitle,ticker:I.fundingToken}:(I==null?void 0:I.daysLeft)!=0?{status:"In repayment",title:I.loanTitle,ticker:I.fundingToken}:{status:"Partialy Repaid",title:I.loanTitle,ticker:I.fundingToken}}else if(R){const I=So(R,E);return I!=null&&I.isReadyForWithdrawal?{status:"Fully Funded",title:I.loanTitle,ticker:I.fundingToken}:(I==null?void 0:I.daysLeft)!=0?{status:"Funding",title:I.loanTitle,ticker:I.fundingToken}:{status:"Cancelled",title:I.loanTitle,ticker:I.fundingToken}}else return{status:"Cancelled"}}function l(y,k,w){const E=new Map(k.map(v=>[v,0n]));return y.forEach(v=>{if(Gt(v)=="Lend to Lend | Tokens"){const I=v.outputs.find(pt),te=qt(I),ne=v0(I),we=I.assets[1].tokenId;ne==z.fromBase58(w).ergoTree&&E.set(we,E.get(we)+te)}}),Array.from(E.entries()).filter(v=>v[1])}function x(y,k,w){const E=new Map(k.map(R=>[R,0n]));return y.filter(R=>$t(R,w)).forEach(R=>{if(Gt(R)=="Fund Crowdfund | Tokens"){const te=R.inputs.find(J),ne=R.outputs.find(J),we=Pe(te)??0n,Uo=(Pe(ne)??0n)-we,Nn=_o(ne);E.set(Nn,E.get(Nn)+Uo)}}),Array.from(E.entries()).filter(R=>R[1])}return f}function S0(e,t,n,s,o){const r=Wt(n,"R4"),i=rn(n,"R6");rn(n,"R7"),rn(n,"R8");const a=BigInt(r[0]),c=BigInt(r[2]),f=BigInt(r[3]),g=a*c/1000n,u=a+g,m=BigInt(e)+f,l={...t,assets:[...t.assets]};return l.assets[1]={tokenId:t.assets[1].tokenId,amount:BigInt(t.assets[1].amount)+1n},l.assets[2]={tokenId:t.assets[2].tokenId,amount:BigInt(t.assets[2].amount)-1n},C0(e,t,n,i,Cn,u,g,m,wo,l,s,o)}function C0(e,t,n,s,o,r,i,a,c,f,g,u){const l=n.assets.slice(2),x=BigInt(n.value)-2n*g,y=BigInt(e),k=F(Ot,[y,r,i,a,0n]).toHex(),w=new L(g,o).addTokens([{tokenId:t.assets[2].tokenId,amount:1n},n.assets[1]]).setAdditionalRegisters({R4:n.additionalRegisters.R4,R5:n.additionalRegisters.R5,R6:n.additionalRegisters.R6,R7:n.additionalRegisters.R7,R8:n.additionalRegisters.R8,R9:k}),E=new L(x,s).addTokens(l),v=new L(f.value,c).addTokens(f.assets).setAdditionalRegisters(f.additionalRegisters);return new Q(e).from([t,n]).to([v,E,w]).payFee(g).sendChangeTo(u).build().toEIP12Object()}function P0(e,t,n,s,o,r){return O0(e,t,n,s,o,r)}function O0(e,t,n,s,o,r){const i=z.fromBase58(t),a=i.ergoTree,c=s.assets,f=ee(s);let g=e;if(c[2]){const l=BigInt(c[2].amount);g=g+l}const u=new L(BigInt(s.value)+2n*r,s.ergoTree).addTokens([s.assets[0],s.assets[1],{amount:g,tokenId:f}]);return u.setAdditionalRegisters({R4:s.additionalRegisters.R4,R5:s.additionalRegisters.R5,R6:s.additionalRegisters.R6,R7:s.additionalRegisters.R7,R8:F(K,a).toHex()}),new Q(o).from([s],{ensureInclusion:!0}).from([...n]).to([u]).payFee(r).sendChangeTo(i).build().toEIP12Object()}function H0(e,t,n,s){const o=e.ergoTree,r=ee(t),{fundingGoal:i}=Ze(t),a=new L(BigInt(t.value)+2n*s,t.ergoTree).addTokens([t.assets[0],t.assets[1],{amount:i,tokenId:r}]);a.setAdditionalRegisters({R4:t.additionalRegisters.R4,R5:t.additionalRegisters.R5,R6:t.additionalRegisters.R6,R7:t.additionalRegisters.R7,R8:F(K,o).toHex()});const c=new L(s,e.ergoTree).addTokens([e.assets[0],e.assets[1]]).setAdditionalRegisters({R4:e.additionalRegisters.R4,R5:e.additionalRegisters.R5,R6:Ot(2n).toHex()});return new Q(n).from([t,e],{ensureInclusion:!0}).withDataFrom([e,t]).to([a,c]).payFee(s).build().toEIP12Object()}function N0(e,t){const s={exleFundingInfo:{fundingGoal:e.fundingGoal,deadlineHeight:e.fundingDeadlineLength+BigInt(t.height),interestRate:e.interestRate,repaymentHeightLength:e.repaymentHeightLength,serviceFee:On(t.serviceBox)},projectDetails:e.project,borrowerErgoTree:z.fromBase58(e.borrowerAddress).ergoTree,tokenId:e.loanTokenId};return D0(e.borrowerAddress,t.userUtxo,t.serviceBox,t.height,ye,s)}function D0(e,t,n,s,o,r){const i=n.boxId,a=On(n),c=z.fromBase58(e),f=new L(m0,Sn).addTokens({tokenId:n.assets[1].tokenId,amount:1n}).mintToken({tokenId:i,amount:1n,decimals:0}),g=U0(f,r),u=new L(a,mo),m=new L(n.value,n.ergoTree).addTokens([n.assets[0],{amount:BigInt(n.assets[1].amount)-1n,tokenId:n.assets[1].tokenId},n.assets[2],n.assets[3]]).setAdditionalRegisters(n.additionalRegisters);return new Q(s).from([n],{ensureInclusion:!0}).from([...t]).to([m,g,u]).payFee(o).sendChangeTo(c).build().toEIP12Object()}function U0(e,t){const{fundingGoal:n,deadlineHeight:s,interestRate:o,repaymentHeightLength:r,serviceFee:i}=t.exleFundingInfo;return e.setAdditionalRegisters({R4:F(Ot,[n,s,o,r,i]).toHex(),R5:F0(t.projectDetails),R6:F(K,t.borrowerErgoTree).toHex(),R7:F(K,t.tokenId).toHex()}),e}function F0(e){const t=e.map(n=>Array.from(Buffer.from(n,"utf8")));return F(F(K),t).toHex()}function M0(e,t,n,s,o){const r=ye,i=t.assets[1].tokenId,a=Ho(i);return $0(e,t,a,n,s,r,o)}function Ho(e){return p0.replace(yo,e)}function $0(e,t,n,s,o,r,i){const a=new L(BigInt(t.value),t.ergoTree).addTokens(t.assets).setAdditionalRegisters(t.additionalRegisters),c=new L(BigInt(e.value),e.ergoTree).addTokens([e.assets[0],e.assets[1],e.assets[2],{tokenId:e.assets[3].tokenId,amount:BigInt(e.assets[3].amount)-1n}]).setAdditionalRegisters(e.additionalRegisters),f=t.assets[1].tokenId,g=On(e),u=new L(g,mo),m=new L(4n*ye,n).addTokens({tokenId:e.assets[3].tokenId,amount:1n}).mintToken({tokenId:e.boxId,amount:b0,decimals:0}).setAdditionalRegisters({R4:F(K,f).toHex(),R5:F(K,e.boxId).toHex(),R6:Ot(0n).toHex()});return console.log(e),console.log(c),new Q(o).from([e,t],{ensureInclusion:!0}).from([...s]).to([c,a,m,u]).payFee(r).sendChangeTo(i).build().toEIP12Object()}function j0(e,t,n,s,o,r,i,a,c){var v,R;const f=new L(t.value,t.ergoTree),g=ee(n),{fundingGoal:u}=Ze(n),m=BigInt(((v=t.assets[2])==null?void 0:v.amount)??0n);console.log("fundedAmount,",m);let l=e;const x=((R=o.assets.find(I=>I.tokenId==g))==null?void 0:R.amount)??0n;x<e&&console.error("not enough");let y;console.log(BigInt(t.assets[1].amount),e),BigInt(u)<=e+m?(l=u-m,y={tokenId:t.assets[1].tokenId,amount:BigInt(t.assets[1].amount)-1n-l},f.addTokens([t.assets[0],{tokenId:t.assets[1].tokenId,amount:1n},{tokenId:g,amount:m+l}]).setAdditionalRegisters({R4:t.additionalRegisters.R4,R5:t.additionalRegisters.R5,R6:Ot(1n).toHex()})):f.addTokens([t.assets[0],{tokenId:t.assets[1].tokenId,amount:BigInt(t.assets[1].amount)-e},{tokenId:g,amount:m+e}]).setAdditionalRegisters(t.additionalRegisters);const k=new L(BigInt(o.value)-a,c);BigInt(x)>l?k.addTokens([{tokenId:t.assets[1].tokenId,amount:l},{tokenId:g,amount:BigInt(x)-l}]):k.addTokens({tokenId:t.assets[1].tokenId,amount:l});const w=t;console.log("7bd13a421902c1202c2f78617e2065429cd2d2f65cce2749122fbe145312e30d?"),console.log("crowdFundBox",{crowdFundBox:t});let E=new Q(i).from([t,o],{ensureInclusion:!0}).from([...r]).withDataFrom([w,s,n]).to([f,k]).payFee(a).sendChangeTo(c).build().toEIP12Object();return y?E=new Q(i).from([t,o],{ensureInclusion:!0}).from([...r]).withDataFrom([w,s,n]).to([f,k]).burnTokens(y).payFee(a).sendChangeTo(c).build().toEIP12Object():E=new Q(i).from([t,o],{ensureInclusion:!0}).from([...r]).withDataFrom([w,s,n]).to([f,k]).payFee(a).sendChangeTo(c).build().toEIP12Object(),E}function z0(e,t,n,s,o,r){const i=ee(s),a=new L(4n*r,Eo).setAdditionalRegisters({R4:F(K,s.boxId).toHex(),R5:F(K,z.fromBase58(t).ergoTree).toHex()}).addTokens({amount:e,tokenId:i});return new Q(o).from([...n]).to([a]).payFee(r).sendChangeTo(t).build().toEIP12Object()}function X0(e,t,n,s,o,r,i){const a=ee(s),c=new L(BigInt(s.value)+3n*i,s.ergoTree);return s.assets[2]?c.addTokens([s.assets[0],s.assets[1],{amount:BigInt(s.assets[2].amount)+e,tokenId:a}]):c.addTokens([s.assets[0],s.assets[1],{amount:e,tokenId:a}]),c.setAdditionalRegisters(s.additionalRegisters),new Q(r).from([s],{ensureInclusion:!0}).from([...n]).withDataFrom([o]).to([c]).payFee(i).sendChangeTo(t).build().toEIP12Object()}let ra=Oe(!1);const En=Oe("nautilus"),Zt=Oe(""),No=Oe(!1),ia=Oe([{ticker:"ERG",amount:23.45*10**9,decimals:9},{ticker:"SigUSD",amount:10878,decimals:2}]);async function V0(){console.log("disconnectWeb3Wallet");try{await window.ergoConnector[qo(En)].disconnect()}catch{}En.set(""),Zt.set("")}async function G0(){const e=window.ergoConnector?Object.keys(window.ergoConnector):[];if(e.length>0)try{let t=await window.ergoConnector[e[0]].connect();const n=await ergo.get_change_address();t?(En.set(e[0]),Zt.set(n)):console.warn(`Connecting ${e[0]} failed.`)}catch(t){console.error(t)}}function aa(){No.update(e=>!e)}function ca(){No.set(!1)}function da(){V0()}function ua(){G0()}const Do=Oe(!0);function fa(){const e=localStorage.getItem("theme")==="dark";Do.set(e),document.documentElement.classList.toggle("dark",e)}function la(){Do.update(e=>{const t=!e;return document.documentElement.classList.toggle("dark",t),t})}const K0=Oe([]),Hn=Oe();async function ha(){const e=await T0(),t=await Bo();if(!e||!t)return;const n=e.map(r=>So(r,t)).filter(Boolean),o=(await I0()).map(r=>Lo(r,t)).filter(Boolean);K0.set([...n,...o])}const ga=ws([Hn,Zt],([e,t],n)=>{if(!e||!t)return;const s=L0(e,t);n(s)},[]),ba=ws([Hn,Zt],([e,t],n)=>{if(!e||!t)return;const s=[...e.crowdfundHistoryTxs,...e.loanHistoryTxs].filter(o=>_0(o)).filter(o=>$t(o,t)).map(o=>k0(o)).filter(Boolean);console.log({transactions:s}),n(s)},[]);async function ma(){const e=await x0();e&&Hn.set(e)}async function De(){await window.ergoConnector.nautilus.connect();const e=await ergo.get_change_address(),t=await ergo.get_utxos(),n=await ergo.get_current_height();return{me:e,utxos:t,height:n}}async function pa(e){const{utxos:t,height:n}=await De(),s=await yt();if(!s)throw new Error("Failed to fetch service box");const r=N0(e,{userUtxo:t,serviceBox:s,height:n}),i=await ergo.sign_tx(r),a=await ergo.submit_tx(i);console.log({sumbited:a})}async function ya(){const{utxos:e,height:t,me:n}=await De(),s=await yt();if(!s)throw new Error("Failed to fetch service box");const o=await qe("9f42a7457d48f34495d8c0c0aa7b5ac99b478e1638e47946077f05476e23a885");if(!o)throw new Error("Failed to fetch lend box");const r=M0(s,o,e,t,n);console.log(r),console.log("------CHECK-----"),console.log(r.inputs[0].assets),console.log(r.outputs[0].assets);const i=await ergo.sign_tx(r);console.log({signed:i});const a=await ergo.submit_tx(i);console.log({sumbited:a})}async function wa(){const e=100n*100n,{utxos:t,height:n,me:s}=await De(),o=await yt();if(!o)throw new Error("Failed to fetch service box");const r=await qe("9f42a7457d48f34495d8c0c0aa7b5ac99b478e1638e47946077f05476e23a885");if(!r)throw new Error("Failed to fetch lend box");const i=r.assets[1].tokenId,a=(await Ao(i))[0];console.log("Crowd?",a);const c={boxId:"b334f7c6c947d5220940e68969d0b2f25aeb13730da7cc45b12cdeeb84dffffc",value:5e7,ergoTree:"0008cd02eb083423041003740c9e791b2fea5ecf6e273669630a25b7ecabf9145395e447",assets:[{tokenId:"f60bff91f7ae3f3a5f0c2d35b46ef8991f213a61d7f7e453d344fa52a42d9f9a",amount:1e10}],creationHeight:1509225,additionalRegisters:{},transactionId:"63bfcbcb9fd24c7e5f174a0a6f5cb2b2d8ef16f762af60b649f01a90acea2f4f",index:0},f=t.filter(l=>l.boxId!=c.boxId),g=j0(e,a,r,o,c,f,n,ye,s);console.log("-----------"),console.log(g),console.log("-----------");const u=await ergo.sign_tx(g);console.log({signed:u});const m=await ergo.submit_tx(u);console.log({sumbited:m})}async function Ia(){const{height:e,me:t}=await De(),n=await qe("9f42a7457d48f34495d8c0c0aa7b5ac99b478e1638e47946077f05476e23a885");if(!n)throw new Error("Failed to fetch lend box");const s=await yt();if(!s)throw new Error("Failed to fetch service box");const o=S0(e,s,n,ye,t);console.log(o)}async function Ta(e){const{height:t,utxos:n,me:s}=await De();if(!await yt())throw new Error("Failed to fetch service box");const r=await qe(e);if(!r)throw new Error("Failed to fetch lend box");const{fundingGoal:i}=Ze(r),a=P0(i,s,n,r,t,ye);console.log("Unsigned TX:",a);const c=await ergo.sign_tx(a);console.log("Signed TX:",c);const f=await ergo.submit_tx(c);console.log("Submitted TX ID:",f)}async function xa(e,t){if(!t||isNaN(Number(t)))throw new Error("Invalid amount");const{height:n,me:s,utxos:o}=await De(),r=await qe(e);if(!r)throw new Error("Failed to fetch lend box");const i=ee(r),a=w0(i),c=BigInt(Math.floor(Number(t)*10**a)),f=z0(c,s,o,r,n,ye);console.log("Prepared TX:",f);const g=await ergo.sign_tx(f);console.log("Signed TX:",g);const u=await ergo.submit_tx(g);return console.log("Submitted TX ID:",u),u}async function ka(){const{height:e}=await De(),t=await qe("9f42a7457d48f34495d8c0c0aa7b5ac99b478e1638e47946077f05476e23a885");if(!t)throw new Error("Failed to fetch lend box");const n=t.assets[1].tokenId,s=(await Ao(n))[0],o=H0(s,t,e,ye);console.log("----------"),console.log(o)}async function Ea(){const{height:e,me:t,utxos:n}=await De(),s=await yt();if(!s)throw new Error("Failed to fetch service box");const o=await qe("e8c6c0d206cddff5268b6789e7cd74e4461785a835488b75b5684a9dc0b66bd0");if(!o)throw new Error("Failed to fetch lend box");console.log({repaymentBox:o});const i=X0(1n,t,n,o,s,e,ye);console.log("----------"),console.log(i);const a=await ergo.sign_tx(i);console.log({signed:a});const c=await ergo.submit_tx(a);console.log({sumbited:c})}export{No as A,oa as B,fa as C,ha as D,ma as E,ra as F,En as G,J0 as a,xa as b,Zt as c,sa as d,ea as e,Ta as f,ba as g,w0 as h,Do as i,na as j,ta as k,pa as l,ga as m,ya as n,wa as o,ka as p,Ea as q,K0 as r,an as s,ia as t,la as u,da as v,Ia as w,ua as x,ca as y,aa as z};
